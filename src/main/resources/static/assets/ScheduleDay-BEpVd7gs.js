import{l as z,r as l,V as ie,R as q,g as F,j as t,a as xe,d as pe,e as R,b as de}from"./index-DB3eQjaF.js";import{d as P,a as ue,b as me,m as he,c as fe,e as ge,F as ye}from"./match-BwJlDZ8C.js";import{K as je,u as H,b as O,c as $,d as ke,e as ve}from"./MarkerClusterer-B-2czHIc.js";import{t as _}from"./tripAtom-CTJPa7nJ.js";import{I as Ce}from"./index-B30wfAHF.js";import{B}from"./button-x43GSXMA.js";import{a as Me}from"./pic-Bp3CpqNF.js";import{C as we}from"./TitleHeader-DaR7UnBM.js";import{B as Ne}from"./BottomModal-CvidPzUl.js";import{R as be}from"./index-gFeoScXN.js";const Se=z.forwardRef(function(w,N){let{position:p,children:d,clickable:i,xAnchor:g,yAnchor:y,zIndex:j,onCreate:h}=w;const r=l.useContext(je),u=H("CustomOverlayMap"),m=l.useMemo(()=>new kakao.maps.LatLng(p.lat,p.lng),[p.lat,p.lng]),n=l.useMemo(()=>{const C=document.createElement("div");return C.style.display="none",new kakao.maps.CustomOverlay({clickable:i,xAnchor:g,yAnchor:y,zIndex:j,position:m,content:C})},[i,g,y]),v=l.useMemo(()=>n.getContent(),[n]);return l.useImperativeHandle(N,()=>n,[n]),l.useLayoutEffect(()=>{if(u)return r?r.addMarker(n,!0):n.setMap(u),()=>{r?r.removeMarker(n,!0):n.setMap(null)}},[u,r,n]),l.useLayoutEffect(()=>{h&&h(n)},[n,h]),O(n,"setPosition",m),O(n,"setZIndex",j),v.parentElement&&ie.createPortal(d,v.parentElement)}),Ie=z.forwardRef(function(w,N){let{path:p,endArrow:d,onClick:i,onMousedown:g,onMousemove:y,onMouseout:j,onMouseover:h,onCreate:r,strokeColor:u,strokeOpacity:m,strokeStyle:n,strokeWeight:v,zIndex:C}=w;const b=H("Polyline"),S=l.useMemo(()=>p.every(f=>f instanceof Array)?p.map(f=>f.map(L=>new kakao.maps.LatLng(L.lat,L.lng))):p.map(f=>new kakao.maps.LatLng(f.lat,f.lng)),[p]),o=l.useMemo(()=>new kakao.maps.Polyline({path:S,endArrow:d,strokeColor:u,strokeOpacity:m,strokeStyle:n,strokeWeight:v,zIndex:C}),[]);return l.useImperativeHandle(N,()=>o,[o]),l.useLayoutEffect(()=>(o.setMap(b),()=>o.setMap(null)),[b,o]),l.useLayoutEffect(()=>{r&&r(o)},[o,r]),l.useLayoutEffect(()=>{o.setOptions({endArrow:d,strokeColor:u,strokeOpacity:m,strokeStyle:n,strokeWeight:v})},[o,d,u,m,n,v]),O(o,"setPath",S),O(o,"setZIndex",C),$(o,"mouseover",h),$(o,"mouseout",j),$(o,"mousemove",y),$(o,"mousedown",g),$(o,"click",i),null}),Ee=({setMemoModal:s,tripId:w,data:N,getTrip:p,setTripData:d,selectedMemo:i=null,handleClickCancle:g,handleClickSubmit:y})=>{q(_),F("accessToken");const[j,h]=l.useState(""),r=()=>{s(!1)},u=n=>{n.stopPropagation()},m=n=>{h(n.target.value)};return l.useEffect(()=>{i&&h(i.content)},[i]),t.jsx("div",{className:`fixed top-0 left-[50%] translate-x-[-50%] z-10\r
                max-w-3xl w-full mx-auto h-full\r
                flex items-center justify-center\r
                bg-[rgba(0,0,0,0.5)]`,onClick:()=>{r()},children:t.jsxs("div",{className:`bg-white w-[630px] \r
                    rounded-2xl px-[60px] py-[55px]\r
                    flex flex-col items-start justify-center gap-[20px]`,onClick:u,children:[t.jsx("h2",{className:"text-[24px] font-semibold px-2",children:"메모"}),t.jsx(Ce,{placeholder:"메모를 입력해주세요.",variant:"borderless",allowClear:!0,value:j,onChange:n=>{m(n)}}),t.jsxs("div",{className:"flex gap-[20px] w-full",children:[t.jsx(B,{color:"default",variant:"filled",onClick:()=>{g()},className:"w-full",children:"취소"}),t.jsx(B,{type:"primary",onClick:()=>{y(j)},className:"text-white w-full",children:"확인"})]})]})})},K=l.memo(Ee),qe=({data:s,showMap:w=!0,newTrip:N=!1,startAt:p,tripId:d,getTrip:i,setTripData:g,index:y,date:j,readOnly:h=!1})=>{const[r,u]=q(_),m=F("accessToken");l.useEffect(()=>{},[r]);const n=xe(),v=()=>{n(`/search/trip?tripId=${d}`),console.log(s)},[C,b]=l.useState(!1);l.useState({lat:35.868475,lng:128.593743}),l.useState();const[S,o]=l.useState(!1),[f,L]=l.useState(null);l.useState(!1);const[W,I]=l.useState(!1),[V,D]=l.useState(!1);l.useEffect(()=>{},[S]);const M=(s==null?void 0:s.schedules)||[],k=M.filter(e=>e.scheOrMemo==="SCHE"),T=k==null?void 0:k.map((e,a)=>({title:e.strfTitle,latlng:{lat:e.lat,lng:e.lng}})),Z=[T.map(e=>e.latlng)],G=e=>{if(!e.length)return{lat:37.5665,lng:126.978};const a=e.filter(x=>x.latlng&&parseFloat(x.latlng.lat)!=null&&x.latlng.lng!=null);if(!a.length)return{lat:37.5665,lng:126.978};const c=a.reduce((x,E)=>(x.lat+=parseFloat(E.latlng.lat),x.lng+=parseFloat(E.latlng.lng),x),{lat:0,lng:0});return{lat:c.lat/a.length,lng:c.lng/a.length}},A=M.filter(e=>e.distance!==null).map(e=>e.distance),J=A.length>0?A.reduce((e,a)=>e+a,0)/A.length:0,Q=e=>e>2e4?10:e>1e4?9:e>5e3?8:5;l.useEffect(()=>{const e=document.createElement("script");return e.async=!0,e.src="//dapi.kakao.com/v2/maps/sdk.js?appkey=1227efa5c91b2ace09ab915e643a15c9&autoload=false",e.addEventListener("load",()=>{window.kakao.maps.load(()=>{b(!0)})}),document.head.appendChild(e),()=>{document.head.removeChild(e)}},[]);const U=()=>{var c;const e=k[k.length-1],a=((c=M[M.length-1])==null?void 0:c.seq)||0;console.log("lastSche",e),console.log("lastSeq",a),u({...r,lastSeq:a,nowTripId:d,day:s.day,prevScheName:k.length>0?e.strfTitle:"",prevSchelat:k.length>0?e.lat:"",prevSchelng:k.length>0?e.lng:""}),v()},X=async e=>{var x;const a=((x=s==null?void 0:s.schedules)==null?void 0:x.length)>0?s.schedules[s.schedules.length-1].seq:0,c={trip_id:r.nowTripId,day:s.day,seq:a+1,content:e};console.log("메모 데이터",c);try{(await R.post("/api/memo/post",c,{headers:{Authorization:`Bearer ${m}`}})).data.code==="200 성공"&&i()}catch(E){console.log("메모 추가",E)}},Y=async e=>{console.log(e);try{const a=await R.delete(`/api/memo/delete?memoId=${e.scheduleMemoId}`,{headers:{Authorization:`Bearer ${m}`}});console.log(a.data),a.data.code==="200 성공"&&i()}catch(a){console.log(a)}},ee=async e=>{const a={memo_id:f.scheduleMemoId,trip_id:r.nowTripId,content:e};console.log("메모 수정 데이터",a);try{const c=await de.patch("/api/memo/upd",a);console.log("메모 수정",c.data),c.data.code==="200 성공"&&i()}catch(c){console.log("메모 수정",c)}},te=e=>{console.log(e),n(`/contents/index?strfId=${e.strfId}`)},se=e=>{L(e),I(!0)},le=()=>{o(!1),I(!1)},ne=()=>{D(!1),o(!1)},ae=()=>{I(!1)},oe=()=>{Y(f),I(!1)},ce=e=>{X(e),o(!1)},re=e=>{ee(e),o(!1),D(!1),I(!1)};return C?t.jsxs("div",{className:"flex flex-col gap-[30px]",children:[t.jsx("div",{className:"h-[10px] bg-slate-100"}),w?t.jsx("div",{className:"h-[292px] px-[32px]",children:t.jsxs(ke,{center:G(T),style:{width:"100%",height:"100%",borderRadius:"8px"},level:Q(J),children:[T.map((e,a)=>t.jsx(Se,{position:e.latlng,children:t.jsxs("div",{className:`label text-white w-[20px] h-[20px]
                  flex items-center justify-center rounded-full
                  
                  ${P(s==null?void 0:s.day)}`,children:[t.jsx("span",{className:"center font-medium text-white text-[12px]",children:a+1})," "]})},`${e.title}-${a}`)),t.jsx(Ie,{path:Z,strokeWeight:3,strokeColor:ue(s==null?void 0:s.day),strokeOpacity:.7,strokeStyle:"solid"})]})}):null,t.jsxs("div",{className:"flex flex-col gap-[20px] px-[32px]",children:[t.jsxs("div",{className:"flex gap-[10px] items-center",children:[t.jsxs("h3",{className:`font-work-sans text-[24px] font-bold ${me(s.day||y+1)} `,children:["Day ",s.day||y+1]}),t.jsx("span",{className:"text-[18px] text-slate-700",children:j}),t.jsx("div",{className:"w-[30px] h-[30px] flex items-center justify-center text-[30px]",children:he(s==null?void 0:s.weather)})]}),t.jsxs("ul",{className:"relative flex flex-col gap-[30px]",children:[M==null?void 0:M.map((e,a)=>{const c=k.findIndex(x=>x.scheduleMemoId===e.scheduleMemoId);return t.jsxs("li",{className:"flex flex-col gap-[30px] justify-center ",children:[e.scheOrMemo==="SCHE"?t.jsxs("div",{className:"flex gap-[30px] items-center cursor-pointer",onClick:()=>{te(e)},children:[t.jsx("div",{className:`w-[30px] h-[30px]
                                  flex items-center justify-center  
                                  rounded-full
                                  text-[16px] text-white font-medium
                                  ${P(s==null?void 0:s.day)}`,children:c!==-1?c+1:"없음"}),t.jsxs("div",{className:"flex gap-[20px] items-center",children:[t.jsx("div",{className:"w-[60px] h-[60px] bg-slate-200 rounded-lg overflow-hidden",children:t.jsx("img",{src:`${Me}${e.strfId}/${e.picName}`,alt:"thum",className:"w-full h-full object-cover"})}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-semibold text-[20px] text-slate-700",children:e.strfTitle}),t.jsxs("div",{className:"flex gap-[10px] items-center",children:[t.jsx("p",{className:"text-[14px] text-slate-500",children:fe(e.category)}),t.jsx("div",{className:"flex gap-[10px] items-center",children:t.jsx("div",{className:"flex gap-[5px] items-center",children:t.jsx(be,{disabled:!0,count:1,value:e.reviewed?1:0,style:{width:"16px",height:"16px",display:"flex",alignItems:"center",justifyContent:"center"}})})})]})]})]})]}):h?null:t.jsxs("div",{className:"flex gap-[30px] items-center",children:[t.jsx("div",{className:"w-[30px] h-[30px] flex items-center justify-center",children:t.jsx("div",{className:`w-[10px] h-[10px] flex items-center justify-center rounded-full  text-[16px] text-white font-medium ${P(s==null?void 0:s.day)}`})}),t.jsxs("div",{className:`flex  gap-[10px] justify-between\r
                  px-[40px] py-[20px] w-full rounded-2xl\r
                  bg-slate-50 `,children:[t.jsxs("div",{className:"flex flex-col gap-[10px]",children:[t.jsxs("p",{className:"flex gap-[5px] text-slate-700",children:[t.jsx(pe,{className:"text-slate-300 text-[18px]"}),e.title]}),t.jsx("p",{className:"text-[14px]",children:e.content})]}),t.jsx("button",{type:"button",onClick:()=>{se(e)},children:t.jsx(we,{className:"text-slate-300 text-[30px]"})})]})]}),e.scheOrMemo==="SCHE"?t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"w-[30px] h-[30px] flex items-center justify-center",children:t.jsx("div",{className:`w-[10px] h-[10px] flex items-center justify-center rounded-full  text-[16px] text-white font-medium ${P(s==null?void 0:s.day)}`})}),t.jsxs("div",{className:`${e.pathType===null?"h-[38px] flex gap-[10px] items-center px-[10px] bg-slate-50 rounded-2xl cursor-pointer":"h-[38px] flex gap-[10px] items-center px-[10px] bg-white rounded-2xl"}`,onClick:()=>{console.log(e)},children:[t.jsx("div",{className:`${e.pathType===null?"text-slate-600 h-[18px]":"text-slate-400 h-[18px]"}`,children:ge(e.pathType)}),t.jsxs("div",{className:`${e.pathType===null?"text-[14px] text-slate-600 h-[18px]":"text-[14px] text-slate-400 h-[18px]"}`,children:[e.duration,e.pathType>0?"분":""]})]})]}):null]},a)}),t.jsx("div",{className:`border-l border-slate-200\r
                                absolute left-[14px] top-1/2 -translate-y-1/2\r
                                h-[90%] -z-10`})]}),N?t.jsxs("div",{className:"flex gap-[20px] items-center",children:[t.jsxs("button",{type:"button",className:`flex items-center justify-center gap-[10px]\r
              py-[10px] rounded-lg\r
              w-full\r
              border border-slate-300\r
              text-slate-700 text-[22px] font-medium`,onClick:U,children:[t.jsx(ye,{className:"text-slate-400 text-[18px]"}),"일정 추가"]}),t.jsxs("button",{type:"button",className:`flex items-center justify-center gap-[10px]\r
              py-[10px] rounded-lg\r
              w-full\r
              border border-slate-300\r
              text-slate-700 text-[22px] font-medium`,onClick:()=>{o(!0)},children:[t.jsx(ve,{className:"text-slate-400 text-[18px]"}),"메모 추가"]})]}):null]}),S?t.jsx(K,{setMemoModal:o,tripId:d,data:s,getTrip:i,setTripData:g,handleClickSubmit:ce,handleClickCancle:le}):null,W?t.jsx(Ne,{showButton:!1,handleClickCancle:ae,modalContent:t.jsxs("div",{className:"flex flex-col gap-[10px] w-full",children:[t.jsx("h3",{className:"text-[20px] font-semibold",children:"메모 편집"}),t.jsxs("ul",{className:"flex flex-col gap-[10px] w-full",children:[t.jsx("li",{className:"w-full",children:t.jsx("button",{type:"button",className:"text-[18px] text-slate-500",onClick:()=>D(!0),children:"수정하기"})}),t.jsx("li",{className:"w-full",children:t.jsx("button",{type:"button",className:"text-[18px] text-slate-500",onClick:oe,children:"삭제하기"})})]})]})}):null,V?t.jsx(K,{selectedMemo:f,setMemoModal:o,tripId:d,data:s,getTrip:i,setTripData:g,handleClickCancle:ne,handleClickSubmit:re}):null]}):t.jsx("div",{children:"지도를 불러오는 중입니다..."})};export{qe as S};
