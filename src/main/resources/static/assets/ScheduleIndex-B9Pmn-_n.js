import{r as o,c as W,j as e,d as N,g as se,R as ne,u as oe,t as re,L as ae}from"./index-Ci2k4qFh.js";import{T as le,R as ie}from"./TitleHeader-BCewOsTi.js";import{c as z}from"./index-2cOcDuMQ.js";import{u as ce,a as G,D as de,c as pe,b as xe,v as me,S as R,K as ue,P as ge}from"./ScheduleDay-Di0NvxY9.js";import{t as he}from"./tripAtom-CNCsf3EQ.js";import{a as fe}from"./MarkerClusterer-BvivFUMB.js";import{d as S}from"./dayjs.min-BpaY4wBy.js";/* empty css                    */import"./UserTrips-BStSkIn8.js";import"./swiper-react-C-W1IIhb.js";/* empty css               */import{c as ye,D as je}from"./index-D_1_DrUA.js";import{n as be,D as Ie}from"./emotion-styled.browser.esm-DOqcqQXy.js";import{F as h}from"./index-N7y8gblw.js";import{I as ke}from"./index-D8xJHd2S.js";import{C as H}from"./index-CaNrhO1F.js";import{B as J}from"./button-wUgNsQBt.js";import"./index-B2xZeB-i.js";import"./match-CsZKVY0N.js";import"./index-DQsKIu_Q.js";import"./pic-Jp7D6aQ0.js";import"./CenterModal-BWpKwMNs.js";import"./index-C8XM4V8E.js";import"./useId-D-Ytk-B6.js";import"./index-n5wX8XHp.js";import"./index-Iuc15HtX.js";import"./Portal-CM-16Ier.js";import"./useSize-D9liuY7G.js";import"./ContextIsolator-DxC-8vna.js";import"./context-n6vFpcCh.js";import"./Footer-jbCLWw7K.js";import"./collapse-BbEVqHco.js";import"./index-6qsLbnf5.js";import"./useLocale-taARNDpF.js";import"./BaseInput-DHAS3V0s.js";import"./PurePanel-CV2A0ptU.js";import"./Overflow-B8qok-nu.js";import"./CheckOutlined-BtFlkLVC.js";import"./EllipsisOutlined-BJmaSG-x.js";import"./Checkbox-CP6SBddq.js";const{RangePicker:Q}=je;S.extend(ye);const we=({tripData:t,handleClickCancle:f,getTrip:T})=>{var j;const[l]=h.useForm(),[y]=W(),A=parseInt(y.get("tripId")),E=()=>{f()},P=r=>{r.stopPropagation()},s=(r,a)=>{console.log("선택된 날짜:",r),console.log("포맷된 날짜:",a);const u=a==null?void 0:a.map(w=>w+":00");setDates(u)},x=r=>r&&r<S().endOf("day");be(Q)`
    .ant-picker-input input {
      color: "#334155" !important;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 0 10px;
      width: 130px;
    }
  `;const _=async r=>{try{const a=await N.patch("/api/trip",r);console.log("여행 수정",a.data),a.data&&(T(),f())}catch(a){console.log("여행 수정",a)}},L=r=>{var g;console.log(r);const{title:a,rangePicker:u,nowUser:w}=r,b=t!=null&&t.nowUser?t.nowUser.map(p=>p.userId).filter(p=>{var v;return!((v=r.nowUser)!=null&&v.includes(p))}):[];(g=r.nowUser)!=null&&g.filter(p=>!b.includes(p));const i=u.map(p=>p.format("YYYY-MM-DD"));console.log(i);const m={title:a,trip_id:A,start_at:i[0],end_at:i[1],del_user_list:b,ins_location_list:[...t==null?void 0:t.tripLocationList],del_location_list:[]};_(m)};return e.jsx("div",{className:`fixed top-0 left-[50%] translate-x-[-50%] z-10\r
            max-w-3xl w-full mx-auto h-screen\r
            flex items-center justify-center\r
            bg-[rgba(0,0,0,0.5)]\r
            `,onClick:()=>{E()},children:e.jsx("div",{className:`bg-white \r
                rounded-2xl px-[60px] py-[30px]\r
                flex flex-col items-center justify-center\r
                gap-[20px]\r
                `,onClick:P,children:e.jsxs(h,{form:l,onFinish:L,requiredMark:!1,children:[e.jsx(h.Item,{name:"title",label:"제목",rules:[{required:!0,message:"제목을 입력해주세요."}],initialValue:t.title,children:e.jsx(ke,{})}),e.jsx(h.Item,{name:"rangePicker",label:"여행일자",rules:[{required:!0,message:"여행일자를 입력해주세요."}],initialValue:t!=null&&t.startAt&&(t!=null&&t.endAt)?[S(t.startAt),S(t.endAt)]:void 0,children:e.jsx(Q,{placeholder:["시작일 ","종료일"],disabledDate:x,variant:"borderless",onChange:s,separator:"~"})}),e.jsx(h.Item,{name:"nowUser",label:"참여자",initialValue:(t==null?void 0:t.tripUserIdList)||[],children:e.jsx(H.Group,{children:((j=t==null?void 0:t.tripUserIdList)==null?void 0:j.map((r,a)=>e.jsx(H,{value:r,children:r},a)))||null})}),e.jsxs(h.Item,{children:[e.jsx(J,{color:"default",variant:"filled",htmlType:"button",onClick:f,children:"취소"}),e.jsx(J,{type:"primary",htmlType:"submit",children:"수정"})]})]})})})},ve=o.memo(we),Ce={day:1,weather:"",schedules:[]},Ne=()=>{var O;se("accessToken");const[t,f]=ne(he);o.useEffect(()=>{console.log("trip",t)},[t]);const[T]=W(),l=parseInt(T.get("tripId"));o.useEffect(()=>{f({...t,nowTripId:l})},[]);const y=oe(),A=()=>{y(-1)},E=()=>{y(`/schedule/calculation?tripId=${l}`)},P=()=>{y(`/scheduleboard/schedulePost?tripId=${l}`)},[s,x]=o.useState({}),[_,L]=o.useState(!1),[j,r]=o.useState(s.title),[a,u]=o.useState(""),[w,b]=o.useState(!1),[i,m]=o.useState(!1);o.useEffect(()=>{d()},[]),o.useState(!1);const[g,p]=o.useState({tripId:null,scheduleId:null,originDay:null,destDay:null,originSeq:null,destSeq:null});o.useEffect(()=>{console.log("여행 데이터",s)},[s]),o.useEffect(()=>{console.log("링크",a)},[a]),o.useEffect(()=>{console.log("title",j)},[j]);const v=o.useCallback(async()=>{try{const n=await N.get(`/api/trip/add-link?trip_id=${l}`);console.log(n.data),u(n.data.data)}catch(n){console.log("초대코드",n)}},[]),B=o.useCallback(async()=>{try{await navigator.clipboard.writeText(a),console.log("복사 성공")}catch(n){console.error("복사 실패:",n)}},[]),X=[{label:e.jsxs("div",{onClick:()=>B(),className:"flex flex-col gap-[10px] items-center justify-center",children:[e.jsx("p",{className:"bg-slate-100 px-[15px] py-[10px] rounded-lg text-slate-600",children:a}),e.jsxs("p",{className:"flex items-center gap-1 border-b border-slate-300",children:[e.jsx("i",{className:"text-slate-500",children:e.jsx(fe,{})}),e.jsx("span",{className:"text-slate-500",children:"초대코드 복사하기"})]})]}),key:"0"}],d=o.useCallback(async()=>{try{const n=await N.get(`/api/trip?trip_id=${l}&signed=true`);console.log("여행확인하기",n.data);const c=n.data.data;x(c),c&&L(!0)}catch(n){console.log(n)}},[]),Z=o.useCallback(async n=>{try{const c=await N.patch("/api/schedule",n);console.log("일정 순서 변경 성공:",c.data)}catch(c){console.log("일정 순서 변경 실패:",c),d()}},[]),D=()=>{b(!1)};o.useEffect(()=>{d(),s&&r(s.title)},[]);const C=s.days,ee=ce(G(ge),G(ue)),te=async n=>{const{active:c,over:F}=n;if(!F)return;const[I,U]=c.id.split("-").map(Number),[$,M]=F.id.split("-").map(Number);if(I===$&&U===M)return;const q=structuredClone(s),Y=q.days.find(k=>k.day===I),V=q.days.find(k=>k.day===$);if(!Y||!V)return;const[K]=Y.schedules.splice(U,1);V.schedules.splice(M,0,K),x(q);try{await Z({tripId:l,scheduleId:K.scheduleMemoId,originDay:I,destDay:$,originSeq:U+1,destSeq:M+1})}catch(k){console.error("Failed to update schedule order:",k),d()}};return o.useEffect(()=>{g.tripId&&console.log("드래그 정보 상태 업데이트:",g)},[g]),e.jsxs("div",{children:[_?e.jsxs(e.Fragment,{children:[e.jsx(le,{icon:"back",onClick:A,rightContent:e.jsx(ie,{icon1:!1,icon2:!0,icon3Click:P,icon3:!0,icon4:!0})}),e.jsxs("div",{className:"flex flex-col gap-[30px] py-[30px]",children:[e.jsxs("div",{className:"mt-[60px] flex flex-col gap-[10px] px-[32px]",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-[18px] text-slate-700 ",children:[e.jsx("span",{children:s.startAt}),"-",e.jsx("span",{children:s.endAt})]}),e.jsx("button",{type:"button",onClick:()=>b(!0),children:e.jsx(re,{className:"text-[24px] text-slate-300 bg-white"})})]}),e.jsx("h2",{className:"text-[36px] text-slate-700 font-bold",children:s.title}),e.jsx("div",{className:"flex items-center gap-3 mt-5"})]}),e.jsxs("div",{className:"flex items-center justify-between gap-[10px] px-[32px]",children:[e.jsxs("div",{className:"flex items-center gap-[10px]",children:[e.jsx(Ie,{menu:{items:X},trigger:["click"],overlayStyle:{marginTop:"10px"},children:e.jsxs("button",{type:"button",className:`flex items-center gap-[10px] \r
                  px-[15px] py-[10px] rounded-3xl\r
                  text-white bg-primary\r
                  hover:bg-primary/80 transition-all duration-300`,onClick:async()=>{await v(),B()},children:[e.jsx(z,{}),"초대 코드"]})}),e.jsxs("button",{type:"button",className:`flex items-center gap-[10px] \r
                px-[15px] py-[10px] rounded-3xl\r
                text-slate-500 bg-slate-100\r
                hover:bg-slate-200/80 transition-all duration-300`,onClick:E,children:[e.jsx(z,{className:"text-slate-300"}),"가계부"]})]}),e.jsxs("div",{className:"flex items-center gap-[10px]",children:[e.jsx("button",{type:"button",className:`flex items-center gap-[10px] \r
                  px-[15px] py-[10px] rounded-3xl\r
                  text-slate-500 bg-slate-100\r
                  hover:bg-slate-200/80 transition-all duration-300`,children:"참여 인원"}),e.jsx("button",{type:"button",className:`flex items-center gap-[10px] 
                    px-[15px] py-[10px] rounded-3xl transition-all duration-300
                    ${i?"text-white bg-primary hover:bg-primary/80":"text-slate-500 bg-slate-100 hover:bg-slate-200/80"}`,onClick:()=>{i?(m(!1),d()):m(!0)},children:i?"완료":"일정 편집"})]})]}),e.jsx("div",{className:"flex flex-col gap-[50px]",children:i?e.jsx(de,{sensors:ee,collisionDetection:pe,onDragEnd:te,children:(O=s.days)==null?void 0:O.map((n,c)=>e.jsx(xe,{items:n.schedules.map((F,I)=>`${n.day}-${I}`),strategy:me,children:e.jsx(R,{newTrip:!0,data:n,startAt:s==null?void 0:s.startAt,tripId:l,getTrip:d,setTripData:x,isDragging:i,setIsDragging:m})},n.day))}):e.jsx(e.Fragment,{children:C===null?e.jsx(R,{newTrip:!0,data:Ce,startAt:s==null?void 0:s.startAt,tripId:l,getTrip:d,setTripData:x,isDragging:i,setIsDragging:m}):C==null?void 0:C.map((n,c)=>e.jsx(R,{newTrip:!0,data:n,startAt:s==null?void 0:s.startAt,tripId:l,getTrip:d,setTripData:x,isDragging:i,setIsDragging:m},n.day))})})]})]}):e.jsx(ae,{}),w&&e.jsx(ve,{tripData:s,handleClickCancle:D,getTrip:d})]})},mt=o.memo(Ne);export{mt as default};
