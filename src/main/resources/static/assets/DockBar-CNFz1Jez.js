import{l as y,w as N,a as S,r as o,g as E,W as _,Q as k,X as C,u as A,m as L,N as i,j as e,L as x,an as R,a3 as T,ao as D,ap as B}from"./index-BntdmLw6.js";import{F as I}from"./index-DGDOMr42.js";import{u as F}from"./userAtom-BmnMlBu9.js";import{L as P}from"./index-uPMp8crv.js";import{s as u}from"./searchAtom-CC56KfOB.js";const M=y({key:"resetSearchData",get:({get:r})=>r(u),set:({set:r})=>{r(u,{searchWord:"",searchData:[],start_idx:0,category:0,amenityId:[],orderType:0,more:!0,count:0})}}),U=N.memo(()=>{const m=S().pathname;o.useState(!1);const l=E("accessToken");_(F),k(u);const p=C(M),h=A(),t=o.useRef(null),g=L.EventSourcePolyfill||NativeEventSource,[c,n]=o.useState(null),f=()=>{const s="/api/chat-notice";t.current=new g(s,{headers:{Authorization:`Bearer ${l}`,Connetction:"keep-alive",Accept:"text/event-stream","Cache-Control":"no-cache"},withCredentials:!0}),t.current.onmessage=a=>{console.log("새로운 알림:",a.data)},t.current.addEventListener("connect",a=>{a.data==="false"?(console.log("없어"),n(!1)):(console.log("있어"),n(!0))}),t.current.onerror=async()=>{var a;(a=t.current)==null||a.close(),setTimeout(f,3e3)},t.current.onopen=()=>{}};o.useEffect(()=>{if(l)return t.current&&(console.log("기존 SSE 연결 닫기"),t.current.close()),f(),()=>{var s;(s=t.current)==null||s.close()}},[t]);const[v,W]=i.useMessage(),[b,w]=o.useState(!1);o.useEffect(()=>{const s=()=>{w(window.scrollY>100)};return window.addEventListener("scroll",s),()=>window.removeEventListener("scroll",s)},[]);const d=()=>{console.log("info 작동"),v.open({type:"info",content:"로그인이 필요한 서비스입니다.",style:{marginTop:"20vh"}})},j=()=>{window.scrollTo({top:0,behavior:"smooth"})};return o.useEffect(()=>{console.log("chatAlert",c)},[c]),e.jsx("div",{children:e.jsxs("div",{className:"flex max-w-[768px] w-full h-auto fixed bottom-0 left-1/2 -translate-x-1/2 bg-white z-50 shadow-[0px_-4px_8px_0px_rgba(99,99,99,0.05)]",children:[e.jsxs(x,{to:"/search/before",className:"text-slate-400 flex flex-1 flex-col justify-center items-center gap-1.5",children:[e.jsx(I,{className:"text-2xl"}),"검색"]}),e.jsxs("button",{type:"button",onClick:()=>{l?h("/search/location"):(d(),i.error("로그인 후 이용 가능한 서비스 입니다"))},className:"text-slate-400 flex flex-1 flex-col justify-center items-center gap-1.5 text-sm",children:[e.jsx(P,{className:"text-2xl"}),"일정"]}),e.jsxs(x,{to:"/",className:"bg-primary text-white w-20 h-20 rounded-full flex flex-col justify-center items-center gap-1.5 relative bottom-5 text-sm",onClick:()=>{p()},children:[e.jsx(R,{className:"text-2xl"}),"홈"]}),e.jsxs(x,{to:"/scheduleboard",className:"text-slate-400 flex flex-1 flex-col justify-center items-center gap-1.5 text-sm",children:[e.jsx(T,{className:"text-2xl"}),"여행기"]}),e.jsxs("button",{type:"button",className:"relative text-slate-400 flex flex-1 flex-col justify-center items-center gap-1.5 text-sm",onClick:()=>{l?(h("/chat"),n(!1)):(d(),i.error("로그인 후 이용 가능한 서비스 입니다"))},children:[e.jsx(D,{className:"text-2xl"}),"채팅",e.jsx("div",{className:`absolute top-3 right-10 w-3 h-3 bg-primary rounded-full border-2 border-white
              ${c?"visible":"invisible"}`})]}),m==="/search/strf"&&e.jsx("div",{className:`absolute bottom-[120px] right-0 -translate-x-1/2 transition-all duration-300 ${b?"opacity-100 visible":"opacity-0 invisible"}`,children:e.jsx("button",{type:"button",className:"bg-primary text-white rounded-full p-[10px] text-[24px] shadow-lg hover:bg-primary/90 transition-colors",onClick:j,children:e.jsx(B,{})})})]})})});export{U as D};
