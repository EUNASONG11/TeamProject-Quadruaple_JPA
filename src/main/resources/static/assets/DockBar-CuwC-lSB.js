import{k as y,ad as S,a as N,r as o,g as E,S as _,J as k,U as C,u as A,l as L,H as i,j as e,L as x,al as R,a0 as T,am as D,an as I}from"./index-DH-Wz4Mj.js";import{F as B}from"./index-CQz5_Up4.js";import{u as M}from"./userAtom-DgR9NHTV.js";import{L as F}from"./index-C50gSxXV.js";import{s as u}from"./searchAtom-Cy7CarFV.js";const P=y({key:"resetSearchData",get:({get:r})=>r(u),set:({set:r})=>{r(u,{searchWord:"",searchData:[],start_idx:0,category:0,amenityId:[],orderType:0,more:!0,count:0})}}),G=S.memo(()=>{const m=N().pathname,[O,$]=o.useState(!1),l=E("accessToken"),{userId:z}=_(M);k(u);const p=C(P),d=A(),t=o.useRef(null),g=L.EventSourcePolyfill||NativeEventSource,[n,c]=o.useState(null),h=()=>{const s="/api/chat-notice";t.current=new g(s,{headers:{Authorization:`Bearer ${l}`,Connetction:"keep-alive",Accept:"text/event-stream","Cache-Control":"no-cache"},withCredentials:!0}),t.current.onmessage=a=>{console.log("새로운 알림:",a.data),a.data==="false"?c(!1):c(!0)},t.current.addEventListener("connect",a=>{}),t.current.onerror=async()=>{var a;(a=t.current)==null||a.close(),setTimeout(h,3e3)},t.current.onopen=()=>{}};o.useEffect(()=>{if(l)return t.current&&(console.log("기존 SSE 연결 닫기"),t.current.close()),h(),()=>{var s;(s=t.current)==null||s.close()}},[t]);const[v,H]=i.useMessage(),[b,w]=o.useState(!1);o.useEffect(()=>{const s=()=>{w(window.scrollY>100)};return window.addEventListener("scroll",s),()=>window.removeEventListener("scroll",s)},[]);const f=()=>{console.log("info 작동"),v.open({type:"info",content:"로그인이 필요한 서비스입니다.",style:{marginTop:"20vh"}})},j=()=>{window.scrollTo({top:0,behavior:"smooth"})};return o.useEffect(()=>{console.log("chatAlert",n)},[n]),e.jsx("div",{children:e.jsxs("div",{className:"flex max-w-[768px] w-full h-auto fixed bottom-0 left-1/2 -translate-x-1/2 bg-white z-50 shadow-[0px_-4px_8px_0px_rgba(99,99,99,0.05)]",children:[e.jsxs(x,{to:"/search/before",className:"text-slate-400 flex flex-1 flex-col justify-center items-center gap-1.5",children:[e.jsx(B,{className:"text-2xl"}),"검색"]}),e.jsxs("button",{type:"button",onClick:()=>{l?d("/search/location"):(f(),i.error("로그인 후 이용 가능한 서비스 입니다"))},className:"text-slate-400 flex flex-1 flex-col justify-center items-center gap-1.5 text-sm",children:[e.jsx(F,{className:"text-2xl"}),"일정"]}),e.jsxs(x,{to:"/",className:"bg-primary text-white w-20 h-20 rounded-full flex flex-col justify-center items-center gap-1.5 relative bottom-5 text-sm",onClick:()=>{p()},children:[e.jsx(R,{className:"text-2xl"}),"홈"]}),e.jsxs(x,{to:"/scheduleboard",className:"text-slate-400 flex flex-1 flex-col justify-center items-center gap-1.5 text-sm",children:[e.jsx(T,{className:"text-2xl"}),"여행기"]}),e.jsxs("button",{type:"button",className:"relative text-slate-400 flex flex-1 flex-col justify-center items-center gap-1.5 text-sm",onClick:()=>{l?(d("/chat"),c(!1)):(f(),i.error("로그인 후 이용 가능한 서비스 입니다"))},children:[e.jsx(D,{className:"text-2xl"}),"채팅",e.jsx("div",{className:`absolute top-3 right-9 w-3 h-3 bg-primary rounded-full border-2 border-white
              ${n?"visible":"invisible"}`})]}),m==="/search/strf"&&e.jsx("div",{className:`absolute bottom-[120px] right-0 -translate-x-1/2 transition-all duration-300 ${b?"opacity-100 visible":"opacity-0 invisible"}`,children:e.jsx("button",{type:"button",className:"bg-primary text-white rounded-full p-[10px] text-[24px] shadow-lg hover:bg-primary/90 transition-colors",onClick:j,children:e.jsx(I,{})})})]})})});export{G as D};
