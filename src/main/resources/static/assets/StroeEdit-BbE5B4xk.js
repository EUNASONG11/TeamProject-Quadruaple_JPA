import{g as I,c as Z,u as W,Q as ee,V as te,r as o,j as s,I as x,B as y,e as m,N as L}from"./index-BntdmLw6.js";import{u as se,F as j}from"./index-8ukATiw3.js";import{h as ae}from"./index.esm-BhK40cBQ.js";import{s as re}from"./strfAtom-DzaPJ9_3.js";import{m as oe,c as le}from"./match-QPO8WXvd.js";import{S as ce}from"./index-xetdIjy9.js";import{U as ie}from"./index-Ic51ErGl.js";import"./motion-C0u11WnX.js";import"./collapse-BbEVqHco.js";import"./zoom-CZrdmVqU.js";import"./Portal-DrvEm9SG.js";import"./responsiveObserver-B1zAiPzw.js";import"./index-f2vjQ5p_.js";import"./index-BwdDw7dk.js";import"./index-CQPU18Q9.js";import"./useId-1CjrgjZ5.js";import"./isMobile-B4CO7CVJ.js";import"./roundedArrow-BJTQLzTE.js";import"./useLocale-DTUvsN8S.js";import"./index-DlpCU_wW.js";import"./index-D--tJV0U.js";import"./index-_SN7yVUb.js";import"./index-uPMp8crv.js";import"./index-B594j0i6.js";import"./fade-Cg5Cr7pw.js";import"./useForceUpdate-DRsOkk5y.js";import"./CheckOutlined-hbsPTsj_.js";const Re=()=>{const p=I("accessToken"),n=I("user").strfDtos[0].busiNum;console.log(n);const[u]=Z(),d=Number(u.get("strfId")),f=u.get("category"),N=u.get("edit"),A=W(),z=()=>{A(`/business/store?strfId=${d}&category=${f}&tab=0`)},[b,de]=ee(re),D=b.strfPics.map((e,a)=>({uid:`prev-${a}`,name:e.strfPic,status:"done",url:`${te}/${d}/${e.strfPic}`})),[l,w]=o.useState(D),[F,g]=o.useState(!1),[T,$]=o.useState(!1),[v,P]=o.useState(""),[c,S]=o.useState(""),[i,k]=o.useState(""),[E,B]=o.useState(""),[R,O]=o.useState(0),[U,_]=o.useState(0),[K]=se(),q=async e=>{console.log("form",e);const a={strfId:d,busiNum:n},t=new FormData;if(!l||l.length===0){console.error("fileList가 비어 있습니다!");return}t.append("p",new Blob([JSON.stringify(a)],{type:"application/json"})),(l.length??!1)&&l.forEach(r=>{t.append("strfPic",r.originFileObj)}),await Q(t)},M=({fileList:e})=>{w(e)},G=async e=>{let a=e.url;a||(a=await new Promise(Y=>{const h=new FileReader;h.readAsDataURL(e.originFileObj),h.onload=()=>Y(h.result)}));const t=new Image;t.src=a;const r=window.open(a);r==null||r.document.write(t.outerHTML)},H=e=>{console.log("file",e),e.uid.includes("prev")&&J(e.name);const a=l.filter(t=>t.uid!==e.uid);w(a)},J=async e=>{const a="/api/detail/strf/pic";try{const r=(await m.delete(`${a}?busiNum=${n}&picName=${e}`,{headers:{Authorization:`Bearer ${p}`}})).data;return r.code==="200 성공"&&console.log("사진 삭제",r),r}catch(t){return console.log("사진 삭제",t),null}},Q=async e=>{const a="/api/detail/strf/pic";g(!0);try{const t=await m.patch(`${a}?strfId=${d}&busiNum=${n}`,e,{headers:{Authorization:`Bearer ${p}`}}),r=t.data;return r.code==="200 성공"&&(g(!1),L.success("사진 변경을 성공했습니다"),z()),console.log("사진 변경",t.data),r}catch(t){return console.log("사진 변경",t),L.error("사진 변경에 실패했습니다"),g(!1),null}};o.useEffect(()=>{const e=document.createElement("script");return e.src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js",e.async=!0,document.body.appendChild(e),()=>{document.body.removeChild(e)}},[]);const V=e=>{console.log("data",e);let a=e.address,t="";e.addressType==="R"&&(e.bname!==""&&(t+=e.bname),e.buildingName!==""&&(t+=t!==""?`, ${e.buildingName}`:e.buildingName),a+=t!==""?` (${t})`:""),P(e.zonecode),B(e.sido),S(a)},C=async e=>{const a="https://dapi.kakao.com/v2/local/search/address";try{const t=await m.get(`${a}?query=${e}`,{headers:{Authorization:"KakaoAK e26abeb161d2171bfd5dabf687976fac"}});return O(Number(t.data.documents[0].y)),_(Number(t.data.documents[0].x)),t.data}catch(t){return console.log("error",t),null}},X=async()=>{const e="/api/detail/address",a={strfId:d,busiNum:n,category:le(f),address:`${c}, ${i}`,locationDetailTitle:E,lat:R,lng:U,post:v};try{const r=(await m.patch(e,a,{headers:{Authorization:`Bearer ${p}`}})).data;console.log("주소 수정",r)}catch(t){console.log("주소 수정",t)}};return o.useEffect(()=>{if(c&&!i&&C(c),c&&i){const e=`${c}, ${i}`;C(e)}},[c,i]),s.jsx("div",{className:"px-4 py-4",children:s.jsxs(ce,{spinning:F,children:[N==="address"&&s.jsxs("div",{className:"flex flex-col gap-3",children:[s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsxs("h3",{className:"text-slate-700 text-lg font-semibold",children:[s.jsx("i",{className:"text-secondary3_3",children:"*"})," 업체 주소"]}),s.jsx("p",{className:"text-base text-slate-500",children:"고객이 방문할 수 있는 주소를 적어주세요."}),s.jsxs("div",{className:"bg-slate-100 rounded-lg p-4",children:[s.jsx("h5",{className:"text-lg text-slate-700",children:"현재 주소"}),s.jsx("p",{className:"text-base text-slate-600",children:b.address})]})]}),s.jsx("h3",{className:"text-slate-700 text-lg pt-5",children:"변경될 주소"}),s.jsxs("div",{className:"flex items-center gap-3 w-full justify-between",children:[s.jsxs("label",{className:"text-sm text-slate-700 flex items-center gap-3 whitespace-nowrap w-full",children:["우편번호",s.jsx(x,{size:"large",placeholder:"우편번호를 입력해주세요.",className:"w-full",onChange:e=>P(e.target.value),value:v})]}),s.jsx(y,{type:"primary",size:"large",onClick:()=>$(!0),children:"검색"})]}),s.jsxs("label",{className:"text-sm text-slate-700 flex items-center gap-9 whitespace-nowrap w-full",children:["주소",s.jsx(x,{size:"large",placeholder:"주소를 입력해주세요.",className:"w-full",onChange:e=>S(e.target.value),value:c})]}),s.jsxs("label",{className:"text-sm text-slate-700 flex items-center gap-3 whitespace-nowrap w-full",children:["상세주소",s.jsx(x,{size:"large",placeholder:"상세주소를 입력해주세요.",className:"w-full",onChange:e=>k(e.target.value),value:i})]}),T&&s.jsx(ae,{onComplete:V,onClose:()=>$(!1),style:{height:"450px"}}),s.jsx(y,{type:"primary",className:"text-lg max-h-[50px] h-[16vw]",size:"large",onClick:()=>X(),children:"수정하기"})]}),N==="strfPic"&&s.jsxs(j,{form:K,onFinish:q,name:"edit",className:"flex flex-col gap-5",children:[s.jsx(j.Item,{name:"strfPic",rules:[{required:!0,message:"메뉴 사진을 등록해주세요.",validator:()=>l.length>0?Promise.resolve():Promise.reject(new Error("메뉴 사진을 등록해주세요."))}],help:`${oe(f)} 이미지는 다수(최대 5장)을 등록하실 수 있습니다.`,children:s.jsx(ie,{listType:"picture-card",fileList:l,onChange:M,onPreview:G,onRemove:H,beforeUpload:()=>!1,accept:"image/*",maxCount:5,children:l.length<5&&"+ Upload"})}),s.jsx(j.Item,{children:s.jsx(y,{type:"primary",htmlType:"submit",size:"large",className:"text-lg",children:"등록하기"})})]})]})})};export{Re as default};
