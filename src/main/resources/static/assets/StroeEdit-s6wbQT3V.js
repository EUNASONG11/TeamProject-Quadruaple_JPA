import{g as C,b as X,u as Y,Q as Z,U as W,r,j as t,I as g,B as h,c as x,N as I}from"./index-CXgPt5JN.js";import{u as ee,F as j}from"./index-03v7AaTi.js";import{h as se}from"./index.esm-Ctp9E7aw.js";import{s as te}from"./strfAtom-C6D7cmuP.js";import{m as ae,c as re}from"./match-YbLQ2-HI.js";import{S as oe}from"./index-DfBx3HSs.js";import{U as le}from"./index-DutcZXZ9.js";import"./motion-COLDN99j.js";import"./collapse-BbEVqHco.js";import"./zoom-DXKB7aGh.js";import"./Portal-DyoJ0XAQ.js";import"./responsiveObserver-C8PfZDab.js";import"./index-Cc8zrrM2.js";import"./index-g46somhf.js";import"./index-DVNH3El3.js";import"./useId-CFvmNKkm.js";import"./isMobile-B4CO7CVJ.js";import"./roundedArrow-BJ1xfU1K.js";import"./useLocale-XAzq5U5g.js";import"./index-CDNxKOHP.js";import"./index-BHcAlC-o.js";import"./index-kMgS0FzX.js";import"./index-D0c2BEnw.js";import"./index-BQ3DKWO0.js";import"./index-DhnFfT0_.js";import"./fade-DtEfEpc4.js";import"./useForceUpdate-Brh-2j-i.js";import"./CheckOutlined-Bh0Z4Jmq.js";const Ue=()=>{const b=C("accessToken"),d=C("user").strfDtos[0].busiNum;console.log(d);const[m]=X(),n=Number(m.get("strfId")),p=m.get("category"),y=m.get("edit"),L=Y(),A=()=>{L(`/business/store?strfId=${n}&category=${p}&tab=0`)},[N,ce]=Z(te),z=N.strfPics.map((e,a)=>({uid:`-${a}`,name:e.strfPic,status:"done",url:`${W}/${n}/${e.strfPic}`})),[l,D]=r.useState(z),[F,u]=r.useState(!1),[T,w]=r.useState(!1),[$,v]=r.useState(""),[i,P]=r.useState(""),[c,k]=r.useState(""),[E,U]=r.useState(""),[B,O]=r.useState(0),[R,_]=r.useState(0),[K]=ee(),q=async e=>{console.log("form",e);const a={strfId:n,busiNum:d},s=new FormData;if(!l||l.length===0){console.error("fileList가 비어 있습니다!");return}s.append("p",new Blob([JSON.stringify(a)],{type:"application/json"})),(l.length??!1)&&l.forEach(o=>{s.append("strfPic",o.originFileObj)}),await H(s)},M=({fileList:e})=>{D(e)},G=async e=>{let a=e.url;a||(a=await new Promise(V=>{const f=new FileReader;f.readAsDataURL(e.originFileObj),f.onload=()=>V(f.result)}));const s=new Image;s.src=a;const o=window.open(a);o==null||o.document.write(s.outerHTML)},H=async e=>{const a="/api/detail/strf/pic";u(!0);try{const s=await x.patch(`${a}?strfId=${n}&busiNum=${d}`,e,{headers:{Authorization:`Bearer ${b}`}}),o=s.data;return o.code==="200 성공"&&(u(!1),I.success("사진 변경을 성공했습니다"),A()),console.log("사진 변경",s.data),o}catch(s){return console.log("사진 변경",s),I.error("사진 변경에 실패했습니다"),u(!1),null}};r.useEffect(()=>{const e=document.createElement("script");return e.src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js",e.async=!0,document.body.appendChild(e),()=>{document.body.removeChild(e)}},[]);const J=e=>{console.log("data",e);let a=e.address,s="";e.addressType==="R"&&(e.bname!==""&&(s+=e.bname),e.buildingName!==""&&(s+=s!==""?`, ${e.buildingName}`:e.buildingName),a+=s!==""?` (${s})`:""),v(e.zonecode),U(e.sido),P(a)},S=async e=>{const a="https://dapi.kakao.com/v2/local/search/address";try{const s=await x.get(`${a}?query=${e}`,{headers:{Authorization:"KakaoAK e26abeb161d2171bfd5dabf687976fac"}});return O(Number(s.data.documents[0].y)),_(Number(s.data.documents[0].x)),s.data}catch(s){return console.log("error",s),null}},Q=async()=>{const e="/api/detail/address",a={p:{strfId:n,busiNum:d,category:re(p),address:`${i}, ${c}`,locationDetailTitle:E,lat:B,lng:R,post:$}};try{const o=(await x.patch(e,a,{headers:{Authorization:`Bearer ${b}`}})).data;console.log("주소 수정",o)}catch(s){console.log("주소 수정",s)}};return r.useEffect(()=>{if(i&&!c&&S(i),i&&c){const e=`${i}, ${c}`;S(e)}},[i,c]),t.jsx("div",{className:"px-4 py-4",children:t.jsxs(oe,{spinning:F,children:[y==="address"&&t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsxs("div",{className:"flex flex-col gap-2",children:[t.jsxs("h3",{className:"text-slate-700 text-lg font-semibold",children:[t.jsx("i",{className:"text-secondary3_3",children:"*"})," 업체 주소"]}),t.jsx("p",{className:"text-base text-slate-500",children:"고객이 방문할 수 있는 주소를 적어주세요."}),t.jsxs("div",{className:"bg-slate-100 rounded-lg p-4",children:[t.jsx("h5",{className:"text-lg text-slate-700",children:"현재 주소"}),t.jsx("p",{className:"text-base text-slate-600",children:N.address})]})]}),t.jsx("h3",{className:"text-slate-700 text-lg pt-5",children:"변경될 주소"}),t.jsxs("div",{className:"flex items-center gap-3 w-full justify-between",children:[t.jsxs("label",{className:"text-sm text-slate-700 flex items-center gap-3 whitespace-nowrap w-full",children:["우편번호",t.jsx(g,{size:"large",placeholder:"우편번호를 입력해주세요.",className:"w-full",onChange:e=>v(e.target.value),value:$})]}),t.jsx(h,{type:"primary",size:"large",onClick:()=>w(!0),children:"검색"})]}),t.jsxs("label",{className:"text-sm text-slate-700 flex items-center gap-9 whitespace-nowrap w-full",children:["주소",t.jsx(g,{size:"large",placeholder:"주소를 입력해주세요.",className:"w-full",onChange:e=>P(e.target.value),value:i})]}),t.jsxs("label",{className:"text-sm text-slate-700 flex items-center gap-3 whitespace-nowrap w-full",children:["상세주소",t.jsx(g,{size:"large",placeholder:"상세주소를 입력해주세요.",className:"w-full",onChange:e=>k(e.target.value),value:c})]}),T&&t.jsx(se,{onComplete:J,onClose:()=>w(!1),style:{height:"450px"}}),t.jsx(h,{type:"primary",className:"text-lg",size:"large",onClick:()=>Q(),children:"수정하기"})]}),y==="strfPic"&&t.jsxs(j,{form:K,onFinish:q,name:"edit",className:"flex flex-col gap-5",children:[t.jsx(j.Item,{name:"strfPic",rules:[{required:!0,message:"메뉴 사진을 등록해주세요.",validator:()=>l.length>0?Promise.resolve():Promise.reject(new Error("메뉴 사진을 등록해주세요."))}],help:`${ae(p)} 이미지는 다수(최대 5장)을 등록하실 수 있습니다.`,children:t.jsx(le,{listType:"picture-card",fileList:l,onChange:M,onPreview:G,beforeUpload:()=>!1,accept:"image/*",maxCount:5,children:l.length<5&&"+ Upload"})}),t.jsx(j.Item,{children:t.jsx(h,{type:"primary",htmlType:"submit",size:"large",className:"text-lg",children:"등록하기"})})]})]})})};export{Ue as default};
