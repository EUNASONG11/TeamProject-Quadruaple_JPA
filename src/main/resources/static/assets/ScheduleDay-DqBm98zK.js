import{z as K,r as l,X as ie,R as q,g as F,j as e,f as xe,B as T,a as pe,d as de,e as R,b as ue}from"./index-C6bOqW8w.js";import{d as P,a as me,b as he,m as fe,c as ge,e as ye,F as je}from"./match-CXPFdkLO.js";import{K as ke,u as H,b as O,c as $,d as ve,e as Ce}from"./MarkerClusterer-Di7cbYwp.js";import{t as _}from"./tripAtom-KNWMMY8l.js";import{a as Me}from"./pic-BhDB7TmH.js";import{C as we}from"./TitleHeader-1NAGEuNC.js";import"./CenterModal-DgygGMr7.js";import{R as Ne}from"./index-CeB-_bz0.js";const be=K.forwardRef(function(v,C){let{position:x,children:p,clickable:r,xAnchor:u,yAnchor:y,zIndex:j,onCreate:f}=v;const i=l.useContext(ke),m=H("CustomOverlayMap"),h=l.useMemo(()=>new kakao.maps.LatLng(x.lat,x.lng),[x.lat,x.lng]),n=l.useMemo(()=>{const w=document.createElement("div");return w.style.display="none",new kakao.maps.CustomOverlay({clickable:r,xAnchor:u,yAnchor:y,zIndex:j,position:h,content:w})},[r,u,y]),M=l.useMemo(()=>n.getContent(),[n]);return l.useImperativeHandle(C,()=>n,[n]),l.useLayoutEffect(()=>{if(m)return i?i.addMarker(n,!0):n.setMap(m),()=>{i?i.removeMarker(n,!0):n.setMap(null)}},[m,i,n]),l.useLayoutEffect(()=>{f&&f(n)},[n,f]),O(n,"setPosition",h),O(n,"setZIndex",j),M.parentElement&&ie.createPortal(p,M.parentElement)}),Se=K.forwardRef(function(v,C){let{path:x,endArrow:p,onClick:r,onMousedown:u,onMousemove:y,onMouseout:j,onMouseover:f,onCreate:i,strokeColor:m,strokeOpacity:h,strokeStyle:n,strokeWeight:M,zIndex:w}=v;const b=H("Polyline"),S=l.useMemo(()=>x.every(g=>g instanceof Array)?x.map(g=>g.map(L=>new kakao.maps.LatLng(L.lat,L.lng))):x.map(g=>new kakao.maps.LatLng(g.lat,g.lng)),[x]),o=l.useMemo(()=>new kakao.maps.Polyline({path:S,endArrow:p,strokeColor:m,strokeOpacity:h,strokeStyle:n,strokeWeight:M,zIndex:w}),[]);return l.useImperativeHandle(C,()=>o,[o]),l.useLayoutEffect(()=>(o.setMap(b),()=>o.setMap(null)),[b,o]),l.useLayoutEffect(()=>{i&&i(o)},[o,i]),l.useLayoutEffect(()=>{o.setOptions({endArrow:p,strokeColor:m,strokeOpacity:h,strokeStyle:n,strokeWeight:M})},[o,p,m,h,n,M]),O(o,"setPath",S),O(o,"setZIndex",w),$(o,"mouseover",f),$(o,"mouseout",j),$(o,"mousemove",y),$(o,"mousedown",u),$(o,"click",r),null}),Ie=({setMemoModal:s,tripId:v,data:C,getTrip:x,setTripData:p,selectedMemo:r=null,handleClickCancle:u,handleClickSubmit:y})=>{q(_),F("accessToken");const[j,f]=l.useState(""),i=()=>{s(!1)},m=n=>{n.stopPropagation()},h=n=>{f(n.target.value)};return l.useEffect(()=>{r&&f(r.content)},[r]),e.jsx("div",{className:`fixed top-0 left-[50%] translate-x-[-50%] z-10\r
                max-w-3xl w-full mx-auto h-full\r
                flex items-center justify-center\r
                bg-[rgba(0,0,0,0.5)]`,onClick:()=>{i()},children:e.jsxs("div",{className:`bg-white w-[630px] \r
                    rounded-2xl px-[60px] py-[55px]\r
                    flex flex-col items-start justify-center gap-[20px]`,onClick:m,children:[e.jsx("h2",{className:"text-[24px] font-semibold px-2",children:"메모"}),e.jsx(xe,{placeholder:"메모를 입력해주세요.",variant:"borderless",allowClear:!0,value:j,onChange:n=>{h(n)}}),e.jsxs("div",{className:"flex gap-[20px] w-full",children:[e.jsx(T,{color:"default",variant:"filled",onClick:()=>{u()},className:"w-full",children:"취소"}),e.jsx(T,{type:"primary",onClick:()=>{y(j)},className:"text-white w-full",children:"확인"})]})]})})},z=l.memo(Ie),Ee=({handleClickCancle:s,handleClickSubmit:v,modalContent:C=null,showButton:x=!0})=>{const p=()=>{s()},r=u=>{u.stopPropagation()};return e.jsx("div",{className:`fixed top-0 left-[50%] translate-x-[-50%] z-10\r
                max-w-3xl w-full mx-auto h-screen\r
                flex items-end justify-center\r
                bg-[rgba(0,0,0,0.5)]\r
                `,onClick:()=>{p()},children:e.jsxs("div",{className:`bg-white w-full \r
                    rounded-t-2xl px-[60px] py-[55px]\r
                    flex flex-col gap-[20px]\r
                    mb-[100px]\r
                    `,onClick:r,children:[C,x?e.jsxs("div",{className:"flex gap-[20px]",children:[e.jsx(T,{color:"default",variant:"filled",htmlType:"button",className:`px-[15px] py-[20px] text-[24px] text-slate-400 font-semibold\r
            w-full`,onClick:s,children:"취소"}),e.jsx(T,{type:"primary",htmlType:"button",className:`px-[15px] py-[20px] text-[24px] text-white font-semibold\r
            w-full`,onClick:v,children:"확인"})]}):null]})})},$e=l.memo(Ee),Ke=({data:s,showMap:v=!0,newTrip:C=!1,startAt:x,tripId:p,getTrip:r,setTripData:u,index:y,date:j,readOnly:f=!1})=>{const[i,m]=q(_),h=F("accessToken");l.useEffect(()=>{},[i]);const n=pe(),M=()=>{n(`/search/trip?tripId=${p}`),console.log(s)},[w,b]=l.useState(!1);l.useState({lat:35.868475,lng:128.593743}),l.useState();const[S,o]=l.useState(!1),[g,L]=l.useState(null);l.useState(!1);const[W,I]=l.useState(!1),[Z,D]=l.useState(!1);l.useEffect(()=>{},[S]);const N=(s==null?void 0:s.schedules)||[],k=N.filter(t=>t.scheOrMemo==="SCHE"),A=k==null?void 0:k.map((t,a)=>({title:t.strfTitle,latlng:{lat:t.lat,lng:t.lng}})),V=[A.map(t=>t.latlng)],X=t=>{if(!t.length)return{lat:37.5665,lng:126.978};const a=t.filter(d=>d.latlng&&parseFloat(d.latlng.lat)!=null&&d.latlng.lng!=null);if(!a.length)return{lat:37.5665,lng:126.978};const c=a.reduce((d,E)=>(d.lat+=parseFloat(E.latlng.lat),d.lng+=parseFloat(E.latlng.lng),d),{lat:0,lng:0});return{lat:c.lat/a.length,lng:c.lng/a.length}},B=N.filter(t=>t.distance!==null).map(t=>t.distance),G=B.length>0?B.reduce((t,a)=>t+a,0)/B.length:0,J=t=>t>2e4?10:t>1e4?9:t>5e3?8:5;l.useEffect(()=>{const t=document.createElement("script");return t.async=!0,t.src="//dapi.kakao.com/v2/maps/sdk.js?appkey=1227efa5c91b2ace09ab915e643a15c9&autoload=false",t.addEventListener("load",()=>{window.kakao.maps.load(()=>{b(!0)})}),document.head.appendChild(t),()=>{document.head.removeChild(t)}},[]);const Q=()=>{var c;const t=k[k.length-1],a=((c=N[N.length-1])==null?void 0:c.seq)||0;console.log("lastSche",t),console.log("lastSeq",a),m({...i,lastSeq:a,nowTripId:p,day:s.day,prevScheName:k.length>0?t.strfTitle:"",prevSchelat:k.length>0?t.lat:"",prevSchelng:k.length>0?t.lng:""}),M()},U=async t=>{var d;const a=((d=s==null?void 0:s.schedules)==null?void 0:d.length)>0?s.schedules[s.schedules.length-1].seq:0,c={trip_id:i.nowTripId,day:s.day,seq:a+1,content:t};console.log("메모 데이터",c);try{(await R.post("/api/memo/post",c,{headers:{Authorization:`Bearer ${h}`}})).data.code==="200 성공"&&r()}catch(E){console.log("메모 추가",E)}},Y=async t=>{console.log(t);try{const a=await R.delete(`/api/memo/delete?memoId=${t.scheduleMemoId}`,{headers:{Authorization:`Bearer ${h}`}});console.log(a.data),a.data.code==="200 성공"&&r()}catch(a){console.log(a)}},ee=async t=>{const a={memo_id:g.scheduleMemoId,trip_id:i.nowTripId,content:t};console.log("메모 수정 데이터",a);try{const c=await ue.patch("/api/memo/upd",a);console.log("메모 수정",c.data),c.data.code==="200 성공"&&r()}catch(c){console.log("메모 수정",c)}},te=t=>{console.log(t),n(`/contents/index?strfId=${t.strfId}`)},se=t=>{L(t),I(!0)},le=()=>{o(!1),I(!1)},ne=()=>{D(!1),o(!1)},ae=()=>{I(!1)},oe=()=>{Y(g),I(!1)},ce=t=>{U(t),o(!1)},re=t=>{ee(t),o(!1),D(!1),I(!1)};return w?e.jsxs("div",{className:"flex flex-col gap-[30px]",children:[e.jsx("div",{className:"h-[10px] bg-slate-100"}),v?e.jsx("div",{className:"h-[292px] px-[32px]",children:e.jsxs(ve,{center:X(A),style:{width:"100%",height:"100%",borderRadius:"8px"},level:J(G),children:[A.map((t,a)=>e.jsx(be,{position:t.latlng,children:e.jsxs("div",{className:`label text-white w-[20px] h-[20px]
                  flex items-center justify-center rounded-full
                  
                  ${P(s==null?void 0:s.day)}`,children:[e.jsx("span",{className:"center font-medium text-white text-[12px]",children:a+1})," "]})},`${t.title}-${a}`)),e.jsx(Se,{path:V,strokeWeight:3,strokeColor:me(s==null?void 0:s.day),strokeOpacity:.7,strokeStyle:"solid"})]})}):null,e.jsxs("div",{className:"flex flex-col gap-[20px] px-[32px]",children:[e.jsxs("div",{className:"flex gap-[10px] items-center",children:[e.jsxs("h3",{className:`font-work-sans text-[24px] font-bold ${he(s.day||y+1)} `,children:["Day ",s.day||y+1]}),e.jsx("span",{className:"text-[18px] text-slate-700",children:j}),e.jsx("div",{className:"w-[30px] h-[30px] flex items-center justify-center text-[30px]",children:fe(s==null?void 0:s.weather)})]}),e.jsxs("ul",{className:"relative flex flex-col gap-[30px]",children:[N==null?void 0:N.map((t,a)=>{const c=k.findIndex(d=>d.scheduleMemoId===t.scheduleMemoId);return e.jsxs("li",{className:"flex flex-col gap-[30px] justify-center ",children:[t.scheOrMemo==="SCHE"?e.jsxs("div",{className:"flex gap-[30px] items-center cursor-pointer",onClick:()=>{te(t)},children:[e.jsx("div",{className:`w-[30px] h-[30px]
                                  flex items-center justify-center  
                                  rounded-full
                                  text-[16px] text-white font-medium
                                  ${P(s==null?void 0:s.day)}`,children:c!==-1?c+1:"없음"}),e.jsxs("div",{className:"flex gap-[20px] items-center",children:[e.jsx("div",{className:"w-[60px] h-[60px] bg-slate-200 rounded-lg overflow-hidden",children:e.jsx("img",{src:`${Me}${t.strfId}/${t.picName}`,alt:"thum",className:"w-full h-full object-cover"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-[20px] text-slate-700",children:t.strfTitle}),e.jsxs("div",{className:"flex gap-[10px] items-center",children:[e.jsx("p",{className:"text-[14px] text-slate-500",children:ge(t.category)}),e.jsx("div",{className:"flex gap-[10px] items-center",children:e.jsx("div",{className:"flex gap-[5px] items-center",children:e.jsx(Ne,{disabled:!0,count:1,value:t.reviewed?1:0,style:{width:"16px",height:"16px",display:"flex",alignItems:"center",justifyContent:"center"}})})})]})]})]})]}):f?null:e.jsxs("div",{className:"flex gap-[30px] items-center",children:[e.jsx("div",{className:"w-[30px] h-[30px] flex items-center justify-center",children:e.jsx("div",{className:`w-[10px] h-[10px] flex items-center justify-center rounded-full  text-[16px] text-white font-medium ${P(s==null?void 0:s.day)}`})}),e.jsxs("div",{className:`flex  gap-[10px] justify-between\r
                  px-[40px] py-[20px] w-full rounded-2xl\r
                  bg-slate-50 `,children:[e.jsxs("div",{className:"flex flex-col gap-[10px]",children:[e.jsxs("p",{className:"flex gap-[5px] text-slate-700",children:[e.jsx(de,{className:"text-slate-300 text-[18px]"}),t.title]}),e.jsx("p",{className:"text-[14px]",children:t.content})]}),e.jsx("button",{type:"button",onClick:()=>{se(t)},children:e.jsx(we,{className:"text-slate-300 text-[30px]"})})]})]}),t.scheOrMemo==="SCHE"?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-[30px] h-[30px] flex items-center justify-center",children:e.jsx("div",{className:`w-[10px] h-[10px] flex items-center justify-center rounded-full  text-[16px] text-white font-medium ${P(s==null?void 0:s.day)}`})}),e.jsxs("div",{className:`${t.pathType===null?"h-[38px] flex gap-[10px] items-center px-[10px] bg-slate-50 rounded-2xl cursor-pointer":"h-[38px] flex gap-[10px] items-center px-[10px] bg-white rounded-2xl"}`,onClick:()=>{console.log(t)},children:[e.jsx("div",{className:`${t.pathType===null?"text-slate-600 h-[18px]":"text-slate-400 h-[18px]"}`,children:ye(t.pathType)}),e.jsxs("div",{className:`${t.pathType===null?"text-[14px] text-slate-600 h-[18px]":"text-[14px] text-slate-400 h-[18px]"}`,children:[t.duration,t.pathType>0?"분":""]})]})]}):null]},a)}),e.jsx("div",{className:`border-l border-slate-200\r
                                absolute left-[14px] top-1/2 -translate-y-1/2\r
                                h-[90%] -z-10`})]}),C?e.jsxs("div",{className:"flex gap-[20px] items-center",children:[e.jsxs("button",{type:"button",className:`flex items-center justify-center gap-[10px]\r
              py-[10px] rounded-lg\r
              w-full\r
              border border-slate-300\r
              text-slate-700 text-[22px] font-medium`,onClick:Q,children:[e.jsx(je,{className:"text-slate-400 text-[18px]"}),"일정 추가"]}),e.jsxs("button",{type:"button",className:`flex items-center justify-center gap-[10px]\r
              py-[10px] rounded-lg\r
              w-full\r
              border border-slate-300\r
              text-slate-700 text-[22px] font-medium`,onClick:()=>{o(!0)},children:[e.jsx(Ce,{className:"text-slate-400 text-[18px]"}),"메모 추가"]})]}):null]}),S?e.jsx(z,{setMemoModal:o,tripId:p,data:s,getTrip:r,setTripData:u,handleClickSubmit:ce,handleClickCancle:le}):null,W?e.jsx($e,{showButton:!1,handleClickCancle:ae,modalContent:e.jsxs("div",{className:"flex flex-col gap-[10px] w-full",children:[e.jsx("h3",{className:"text-[20px] font-semibold",children:"메모 편집"}),e.jsxs("ul",{className:"flex flex-col gap-[10px] w-full",children:[e.jsx("li",{className:"w-full",children:e.jsx("button",{type:"button",className:"text-[18px] text-slate-500",onClick:()=>D(!0),children:"수정하기"})}),e.jsx("li",{className:"w-full",children:e.jsx("button",{type:"button",className:"text-[18px] text-slate-500",onClick:oe,children:"삭제하기"})})]})]})}):null,Z?e.jsx(z,{selectedMemo:g,setMemoModal:o,tripId:p,data:s,getTrip:r,setTripData:u,handleClickCancle:ne,handleClickSubmit:re}):null]}):e.jsx("div",{children:"지도를 불러오는 중입니다..."})};export{Ke as S};
