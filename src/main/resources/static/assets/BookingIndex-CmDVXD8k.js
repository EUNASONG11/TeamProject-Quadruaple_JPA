import{j as e,d as I,c as z,Q as R,g as q,u as O,a as U,r as t,T as W,am as F,I as G,B as C,e as h}from"./index-BntdmLw6.js";import{u as H}from"./userAtom-BmnMlBu9.js";import"./ko-Da14ESg7.js";import{C as P}from"./index-DGV9hIgg.js";import{R as Q}from"./index-DOs-gtuZ.js";import"./Checkbox-CWqL9gsF.js";import"./useBubbleLock-CI5H0IC6.js";import"./useId-1CjrgjZ5.js";const J=({setShowCouponModal:i,couponList:u,selectCoupon:f,setSelectCoupon:j})=>{const o=()=>{i(!1)},d=s=>{s.stopPropagation()},b=s=>{j(s),i(!1)};return e.jsx("div",{className:`flex items-end justify-end \r
                    max-w-3xl w-full h-full mx-auto  \r
                    bg-[rgba(0,0,0,0.5)] \r
                    fixed bottom-0 left-[50%] translate-x-[-50%] z-50`,onClick:o,children:e.jsxs("div",{className:`\r
          flex flex-col gap-[30px]\r
          px-[20px] py-[30px] w-full\r
          rounded-t-3xl\r
        bg-white`,onClick:d,children:[e.jsx("h2",{className:"text-[24px] text-slate-700 font-semibold",children:"쿠폰 선택"}),e.jsx("ul",{className:"max-h-[411px] overflow-y-scroll",children:u.map((s,m)=>e.jsxs("li",{className:`flex flex-col gap-[20px]\r
                          px-[20px] py-[20px] `,onClick:()=>b(s),children:[e.jsxs("p",{className:"text-[28px] text-primary font-bold",children:[s.discountPer,"%"]}),e.jsxs("div",{className:"flex flex-col gap-[5px]",children:[e.jsx("h4",{className:"text-[20px] text-slate-700 font-semibold",children:s.title}),e.jsx("p",{className:"text-[18px] text-slate-400",children:`${I(s.expiredAt).format("YYYY-MM-DD")} 사용 가능`})]})]},m))})]})})};P.Group;const K=[],ce=()=>{const[i,u]=z();i.get("strfId");const[f,j]=R(H),o=q("accessToken"),d=O(),s=U().state;console.log("locationState",s);const m=()=>{d(-1)},[a,_]=t.useState({}),[D,g]=t.useState(!1),[r,L]=t.useState([]),[c,B]=t.useState({});t.useState(K);const[N,Y]=t.useState(!1);t.useState(!1);const[y,w]=t.useState("99"),[x,k]=t.useState(0),[$,A]=t.useState((s==null?void 0:s.item.menuPrice)||0);t.useEffect(()=>{console.log("userData",a)},[a]),t.useEffect(()=>{console.log("couponList",r)},[r]),t.useEffect(()=>{console.log("selectCoupon",c),c.discountPer?k(c.discountPer):k(0)},[c]),t.useEffect(()=>{A((s==null?void 0:s.item.menuPrice)-x/100*(s==null?void 0:s.item.menuPrice))},[x]);const E=async()=>{try{const n=(await h.get("/api/user/userInfo",{headers:{Authorization:`Bearer ${o}`}})).data;_(n.data)}catch(l){console.log("회원 정보:",l)}},T=async()=>{try{const l=await h.get("/api/coupon/available-coupons",{headers:{Authorization:`Bearer ${o}`}});console.log("쿠폰 불러오기",l.data);const n=l.data;L(n.data.coupons)}catch(l){console.log("쿠폰 불러오기 결과:",l)}},M=async()=>{const l={num:1,point:5e3,strf_id:s.contentData.strfId,check_in:s.dates[0],check_out:s.dates[1],coupon_id:isNaN(parseInt(c.couponId))?null:parseInt(c.couponId),actual_paid:$,menu_id:s.item.menuId,room_id:1};console.log("sendData",l);try{const n=await h.post("/api/booking",{...l},{headers:{Authorization:`Bearer ${f.accessToken}`}});console.log("예약하기 결과",n.data);const p=n.data;p.code==="200 성공"&&p.data?(d("/booking/waiting"),console.log("카카오페이먼트 도전"),window.open(p.data,"_blank","width=500,height=700")||alert("팝업이 차단되었습니다. 팝업 차단을 해제해주세요.")):alert("결제 요청 실패")}catch(n){console.log("예약하기 결과:",n)}},v=l=>I(l).locale("ko").format("YYYY년 MM월 DD일 (ddd)");return t.useEffect(()=>{E(),T()},[]),e.jsxs("div",{children:[e.jsx(W,{icon:"back",title:"예약하기",onClick:m}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex flex-col ",children:[e.jsx("h2",{className:"px-4  py-3 border-b border-slate-100 text-lg text-slate-700 font-semibold",children:(s==null?void 0:s.contentData.strfTitle)||"업체이름"}),e.jsxs("ul",{className:"flex flex-col gap-6 py-4 px-4",children:[e.jsxs("li",{className:"flex items-center",children:[e.jsx("h4",{className:"w-1/2 text-base text-slate-700 font-semibold",children:"객실명"}),e.jsx("p",{className:"w-1/2 text-base text-slate-700",children:(s==null?void 0:s.item.menuTitle)||"객실명"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("h4",{className:"w-1/2 text-base text-slate-700 font-semibold",children:"입실일"}),e.jsx("p",{className:"w-1/2 text-base text-primary tracking-tight",children:v(s==null?void 0:s.dates[0])})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("h4",{className:"w-1/2 text-base text-slate-700 font-semibold",children:"퇴실일"}),e.jsx("p",{className:"w-1/2 text-base text-slate-700 tracking-tight",children:v(s==null?void 0:s.dates[1])})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("h4",{className:"w-1/2 text-base text-slate-700 font-semibold",children:"인원"}),e.jsxs("p",{className:"w-1/2 text-base text-slate-700",children:["성인 ",s==null?void 0:s.quantity,"명"]})]})]})]}),e.jsx("section",{className:"w-full h-[10px] bg-slate-100"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h2",{className:"p-4 border-b border-slate-100 text-lg text-slate-700 font-semibold",children:"예약자 정보 입력"}),e.jsxs("ul",{className:"flex flex-col gap-3 py-3 px-4",children:[e.jsxs("li",{className:"flex items-center gap-3",children:[e.jsx("h4",{className:"text-sm text-slate-700",children:"예약자"}),e.jsx("input",{type:"text",className:`flex-grow text-xs text-slate-400 \r
                          border border-slate-300 rounded-lg\r
                          p-3 outline-none bg-slate-50`,value:(a==null?void 0:a.name)||"이름입니다.",readOnly:!0})]}),e.jsxs("li",{className:"flex items-center gap-3",children:[e.jsx("h4",{className:"text-sm text-slate-700",children:"이메일"}),e.jsx("input",{type:"text",className:`flex-grow text-xs text-slate-400 \r
                          border border-slate-300 rounded-lg\r
                          p-3 outline-none bg-slate-50`,value:(a==null?void 0:a.email)||"이메일입니다.",readOnly:!0})]}),e.jsxs("li",{className:"flex items-center gap-3",children:[e.jsx("h4",{className:"text-sm text-slate-700",children:"휴대폰"}),e.jsx("input",{type:"text",className:`flex-grow text-xs text-slate-400 \r
                          border border-slate-300 rounded-lg\r
                          p-3 outline-none bg-slate-50`,value:(a==null?void 0:a.tell)||"휴대폰 번호입니다.",readOnly:!0})]})]})]}),e.jsx("section",{className:"w-full h-[10px] bg-slate-100"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h2",{className:"p-4 border-b border-slate-100 text-lg text-slate-700 font-semibold",children:"할인쿠폰"}),e.jsxs("div",{className:"flex flex-col gap-3 py-3 px-4",children:[e.jsxs("button",{type:"button",onClick:()=>{r.length>0&&g(!0)},className:`p-3 rounded-lg
            border border-slate-300
            flex items-center justify-between
            ${r.length>0?"bg-white":"bg-slate-200"}`,children:[e.jsx("p",{className:"text-xs text-slate-500",children:c.title?c.title:r.length>0?`사용 가능한 쿠폰이 ${r.length}개 있어요.`:"사용 가능한 쿠폰이 없어요."}),e.jsx(F,{className:"text-[18px] text-slate-400"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("p",{className:"text-sm text-slate-700 whitespace-nowrap mr-[8px]",children:"포인트"}),e.jsx(G,{value:y,onChange:w,className:"text-xs text-right border p-3"}),e.jsx(C,{onClick:()=>{w(99)},className:"text-xs text-slate-500 h-auto py-3",children:"전액사용"})]}),e.jsxs("sub",{className:"w-full inline-block text-xs text-slate-500 text-right bottom-0",children:["보유 포인트 : ",y.toLocaleString(),"p"]})]})]})]}),e.jsx("section",{className:"w-full h-[10px] bg-slate-100"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h2",{className:"p-4 border-b border-slate-100 text-lg text-slate-700 font-semibold",children:"결제정보"}),e.jsxs("ul",{className:"flex flex-col gap-3 px-4 py-3 w-full",children:[e.jsxs("li",{className:"w-full flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm text-slate-500",children:"예약 금액"}),e.jsxs("p",{className:"text-base text-slate-700",children:[((s==null?void 0:s.item.menuPrice)||0).toLocaleString(),"원"]})]}),e.jsxs("li",{className:"w-full flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm text-slate-500",children:"상품 할인"}),e.jsx("p",{className:"text-base text-slate-700",children:"0원"})]}),e.jsxs("li",{className:"w-full flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm text-slate-500",children:"포인트사용"}),e.jsx("p",{className:"text-base text-slate-700",children:x===0?"0원":`${x}%`})]}),e.jsxs("li",{className:"w-full flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm text-slate-500",children:"쿠폰 할인"}),e.jsx("p",{className:"text-base text-slate-700",children:x===0?"0원":`${x}%`})]})]}),e.jsxs("div",{className:"w-full flex items-center justify-between py-3 px-4 border-t border-slate-100",children:[e.jsx("h4",{className:"text-base text-primary font-semibold",children:"총 결제 금액"}),e.jsxs("p",{className:"text-lg text-primary font-semibold",children:[e.jsx("span",{children:((s==null?void 0:s.item.menuPrice)*(s==null?void 0:s.quantity)-x/100*((s==null?void 0:s.item.menuPrice)*(s==null?void 0:s.quantity))).toLocaleString()}),"원"]})]})]}),e.jsx("section",{className:"w-full h-[10px] bg-slate-100"}),e.jsxs("div",{className:"py-3 px-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-700 ml-1 mb-3",children:"결제수단"}),e.jsx("div",{className:"px-3 py-4 border-[1px] border-slate-200 rounded-lg flex items-center justify-between mb-3",children:e.jsx(Q,{defaultChecked:!0,className:"custom-payment-radio text-base text-slate-700",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:"/images/payment/payment_icon_yellow_small.png",alt:"payment_icon_yellow_small",className:"w-[60px]"}),e.jsx("span",{children:"카카오페이"})]})})}),e.jsxs("div",{className:"bg-slate-50 p-5 rounded-lg",children:[e.jsx("p",{className:"text-lg text-slate-700 mb-[6px]",children:"결제혜택"}),e.jsx("p",{className:"text-sm text-slate-500 tracking-tight",children:'본 프로모션은 카카오페이 계정 기준 "기간 내 1회, 카카오페이머니 결제"에 한해 페이포인트 적립 가능합니다. - 포인트 적립은 장바구니 합산 기준으로 최종 결제 금액 4만원 이상 시 자동 적립되며, 카카오페이 톡채널로 안내됩니다. (기간 내 누적 결제금액이 아닌 단건 결제에 한함) - 기간 내 선착순 3천명 대상으로 예산 소진 시 별도 고지 없이 조기 종료 될 수 있습니다. - 예산 소진 시 페이포인트 적립 메세지가 발송되지 않습니다. - 포인트 사용 유효기간은 적립일로부터 60개월입니다. - 적립된 포인트는 카카오페이 제휴 가맹점에서 사용 가능합니다.'})]})]}),e.jsxs("div",{className:"py-3 px-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-700",children:"취소정책 및 이용 동의"}),e.jsx(P,{className:"custom-payment-checkbox w-full text-base rounded-lg my-3 text-slate-700",checked:N,onChange:l=>Y(l.target.checked),children:"주문 내용과 아래 유의 사항을 확인하였으며 결제 진행에 동의합니다."}),e.jsx(C,{type:"primary",disabled:!N,onClick:()=>M(),className:"w-full text-base py-3 !h-auto",children:"결제하기"}),e.jsx("p",{className:"mt-3 text-sm text-slate-500",children:'• 본 약관은 주식회사 카카오페이(이하 "회사"라 합니다)가 제공하는 카카오페이 서비스의 이용과 관련하여 회사와 회원 사이의 권리, 의무 및 책임사항, 기타 필요한 사항을 규정함을 목적으로 합니다.'})]})]}),D?e.jsx(J,{setShowCouponModal:g,couponList:r,selectCoupon:c,setSelectCoupon:B}):null]})};export{ce as default};
