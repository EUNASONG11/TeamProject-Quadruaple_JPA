import{r as j,g as V,c as P,u as ce,Q as q,j as s,af as de,d as A,V as ue,I as F,aj as me,N as m,e as g,s as fe,ai as N,aD as he}from"./index-BntdmLw6.js";import{s as K}from"./strfAtom-DzaPJ9_3.js";import{f as pe,g as O,h as E,e as ge,i as xe,t as $e,c as ye}from"./match-QPO8WXvd.js";import{k as je,T as _}from"./koreaAreaCode-CTzhMvgY.js";import{S as v}from"./index-CvW-_NZc.js";import{S as Y}from"./index-xetdIjy9.js";import{P as be}from"./index-HSKGSHVr.js";import{c as Ce}from"./customParseFormat-5wskB_7Y.js";import{S as ke}from"./StrfInfo-ByrxGPUu.js";import"./index-DlpCU_wW.js";import"./index-D--tJV0U.js";import"./index-_SN7yVUb.js";import"./index-uPMp8crv.js";import"./index-B594j0i6.js";import"./PurePanel-UKNAQVax.js";import"./index-7h6nBgB8.js";import"./index-CQPU18Q9.js";import"./Portal-DrvEm9SG.js";import"./useId-1CjrgjZ5.js";import"./isMobile-B4CO7CVJ.js";import"./Overflow-DP5qerSy.js";import"./useIcons-Ds5xDlqb.js";import"./CheckOutlined-hbsPTsj_.js";import"./DownOutlined-B2Akvkot.js";import"./roundedArrow-BJTQLzTE.js";import"./useLocale-DTUvsN8S.js";import"./motion-C0u11WnX.js";import"./index-BwdDw7dk.js";import"./zoom-CZrdmVqU.js";const Ae=({title:$,type:a})=>{const f=V("accessToken"),x=V("user"),d=x.strfDtos[0].busiNum,[w]=P(),u=Number(w.get("strfId")),I=w.get("category"),H=ce(),T=()=>{H(`/business/store/edit?strfId=${u}&category=${I}&edit=${a}`)},[t,y]=q(K),[h,z]=j.useState(!1),[k,i]=j.useState(!1),[r,c]=j.useState(null),[S,Q]=j.useState("weekly"),[D,B]=j.useState(""),U=e=>{(r==null?void 0:r.includes(e))===!0?c(l=>[...l.filter(o=>o!==e)]):c(l=>[...l,e])},C=async()=>{const e="/api/detail/member";i(!0);try{const o=(await g.get(`${e}?strf_id=${u}`,{headers:{Authorization:`Bearer ${f}`}})).data;if(o){const n=o.data.tell.split("-");y(p=>({...p,...o.data,areaCode:n[0],tell:`${n[1]}-${n[2]}`})),fe("user",{...x,strfDtos:[{...x.strfDtos[0],title:o.data.strfTitle}]}),i(!1)}return o}catch(l){return i(!1),console.log("상품조회",l),null}},M=async()=>{const e="/api/detail/title",l={strfId:u,busiNum:d,title:r};console.log("payload",l),i(!0);try{const n=(await g.patch(`${e}?strfId=${u}&title=${r}&busiNum=${d}`,l,{headers:{Authorization:`Bearer ${f}`}})).data;return console.log(n),n&&(C(),i(!1),y({...t,strfTitle:r}),m.success("업체명 변경이 변경되었습니다")),n}catch(o){return console.log("이름 변경",o),i(!1),m.error("업체명 변경에 실패했습니다."),null}},G=async()=>{const e="/api/detail/state",l={strfId:u,busiNum:d,state:r};console.log("payload",l),i(!0);try{const n=(await g.patch(`${e}?strfId=${u}&state=${r}&busiNum=${d}`,l,{headers:{Authorization:`Bearer ${f}`}})).data;return console.log("영업 상태 변경",n),n.code==="200 성공"&&(i(!1),C(),y(p=>({...p,state:r})),m.success("영업 상태 변경에 성공했습니다.")),n}catch(o){return console.log("영업 상태 변경",o),m.error("영업 상태 변경에 실패했습니다."),i(!1),null}},J=async()=>{const e="/api/detail/tell";i(!0);const l={strfId:u,tell:`${D}-${r}`,busiNum:d};try{const n=(await g.patch(`${e}?strfId=${u}&tell=${D}-${r}&busiNum=${d}`,l,{headers:{Authorization:`Bearer ${f}`}})).data;return n.code&&(i(!1),C(),y({...t,areaCode:D,tell:r.split("-",1)}),m.success("전화번호 변경이 완료되었습니다")),console.log("전화번호 변경",n),n}catch(o){return i(!1),m.error("전화번호 변경에 실패하였습니다"),console.log("전화번호 변경",o),null}},W=async()=>{const e="/api/detail/detail";i(!0);const l={strfId:u,detail:r,busiNum:d};try{const n=(await g.patch(`${e}?strfId=${u}&detail=${r}&busiNum=${d}`,l,{headers:{Authorization:`Bearer ${f}`}})).data;return n.code&&(i(!1),C(),y(p=>({...p,detail:r})),m.success("업체 소개 변경이 완료되었습니다")),console.log("업체소개 변경",n),n}catch(o){return i(!1),m.error("업체소개 변경에 실패하였습니다"),console.log("업체소개 변경",o),null}},X=async()=>{const e="/api/detail/amenity";i(!0);const l={strfId:u,busiNum:d,category:ye(I),ameniPoints:r},o=t.amenity.map(n=>`ameniPoints=${n}`);console.log("보낼 파라메터",o.join("&"));try{const p=(await g.patch(`${e}?strfId=${u}&busiNum=${d}&category=${I}&${o.join("&")}`,l,{headers:{Authorization:`Bearer ${f}`}})).data;return p.code&&(i(!1),C(),m.success("편의시설 변경이 완료되었습니다")),console.log("편의시설 변경",p),p}catch(n){return i(!1),m.error("편의시설 변경에 실패하였습니다"),console.log("편의시설 변경",n),null}},Z=async()=>{const e="/api/detail/amenity";try{const o=(await g.delete(`${e}?strfId=${u}&busiNum=${d}`,{headers:{Authorization:`Bearer ${f}`}})).data;o&&(console.log("편의시설 삭제",o),X())}catch(l){console.log("편의시설 삭제",l)}},ee=async()=>{const e="/api/detail/time",l={strfId:u,busiNum:d,openCheckIn:r[0],closeCheckOut:r[1]};console.log("payload",l),i(!0);try{const n=(await g.patch(`${e}?strfId=${u}&busiNum=${d}&openCheckIn=${r[0]}&closeCheckOut=${r[1]}`,l,{headers:{Authorization:`Bearer ${f}`}})).data;return console.log("체크시간 변경",n),n&&(C(),i(!1),y({...t,strfTitle:r[0],closeCheck:r[1]}),m.success("체크시간 변경이 변경되었습니다")),n}catch(o){return console.log("체크시간 변경",o),i(!1),m.error("체크시간 변경에 실패했습니다."),null}},te=async()=>{const e="/api/detail/fest/time",l={strfId:u,busiNum:d,startAt:t.startAt,endAt:t.endAt};console.log("payload",l),i(!0);try{const n=(await g.put(`${e}?strfId=${u}&busiNum=${d}&startAt=${t.startAt}&endAt=${t.endAt}`,l,{headers:{Authorization:`Bearer ${f}`}})).data;return console.log("기간 변경",n),n&&(C(),i(!1),y({...t,strfTitle:r}),m.success("기간이 변경되었습니다")),n}catch(o){return console.log("기간 변경",o),i(!1),m.error("기간 변경에 실패했습니다."),null}},se=async()=>{const e="/api/detail/rest",l=r.map(p=>xe(p)),o={strfId:u,busiNum:d,restDates:l};console.log("payload",o),i(!0);const n=l.map(p=>`restDates=${p}`).join("&");console.log("restDatesPara",n);try{const R=(await g.patch(`${e}?strfId=${u}&busiNum=${d}&${n}`,o,{headers:{Authorization:`Bearer ${f}`}})).data;return console.log("휴무일 변경",R),R&&(C(),i(!1),y(ie=>({...ie,restDate:$e(r)})),m.success("휴무일이 변경되었습니다")),R}catch(p){return console.log("휴무일 변경",p),i(!1),m.error("휴무일 변경에 실패했습니다."),null}},ae=async()=>{const e="/api/detail/rest";try{const o=(await g.delete(`${e}?strfId=${u}&busiNum=${d}`,{headers:{Authorization:`Bearer ${f}`}})).data;return o&&(console.log("영업 상태 삭제",o),se()),o}catch(l){return console.log("영업 상태 삭제",l),null}},re=()=>{if(a==="strfPic"){T();return}if(a==="address"){T();return}z(!h),h===!1&&(a==="title"&&c(t.strfTitle),a==="tell"&&c(t.tell),a==="tell"&&B(t.areaCode??""),a==="detail"&&c(t.detail),a==="amenity"&&c(t.amenity),a==="state"&&c(t.state),a==="duration"&&c(`${t.startAt}~${t.endAt}`),a==="checkTime"&&c([t.openCheck,t.closeCheck]),a==="restDate"&&c(t.restDate.map(e=>E(e)))),h===!0&&(a==="title"&&(r===t.strfTitle?m.warning("동일한 이름으로 수정을 취소합니다"):(r==null?void 0:r.trim())!==""&&M()),a==="state"&&(r===t.state?m.warning("동일한 상태이기 때문에 수정을 취소합니다"):G()),a==="tell"&&(D===t.areaCode||r===t.tell?m.warning("동일한 전화번호이기 때문에 수정을 취소합니다"):D!==""&&r!==""&&J()),a==="detail"&&(r===t.detail?m.warning("동일한 상품소개이기 때문에 수정을 취소합니다"):r.trim()!==""&&W()),a==="amenity"&&Z(),a==="duration"&&te(),a==="checkTime"&&ee(),a==="restDate"&&ae())},le=[{value:0,label:"영업중"},{value:1,label:"휴업"},{value:2,label:"폐업"}],oe=s.jsx(v,{defaultValue:t.areaCode,onChange:e=>{B(e)},children:je.map(e=>s.jsx(v.Option,{value:e.code,children:e.code},e.code))}),ne=e=>{const o=e.replace(/[^\d]/g,"").slice(0,7);return o.length>3?`${o.slice(0,3)}-${o.slice(3)}`:o},L={frequency:[{label:"없음",value:"none"},{label:"매주",value:"weekly"}],day:[{label:"월",value:"월"},{label:"화",value:"화"},{label:"수",value:"수"},{label:"목",value:"목"},{label:"금",value:"금"},{label:"토",value:"토"},{label:"일",value:"일"}]};return j.useEffect(()=>{if(a==="tell"&&typeof t.tell=="string"){const e=t.tell?t.tell.split("-"):["000","0000","0000"];B(e[0]),c(`${e[1]}-${e[2]}`)}a==="detail"&&typeof t.detail=="string"&&c(t.detail),a==="amenity"&&c([...t.amenity])},[t,a]),s.jsxs("section",{className:"px-7 pt-4 pb-5 flex flex-col gap-2 border-b-2 border-slate-100",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"text-xl font-semibold text-slate-700",children:$}),s.jsxs("button",{type:"button",className:"flex items-center gap-1 text-primary font-semibold hover:text-primary2 transition-all duration-300",onClick:re,children:[!h&&s.jsxs(s.Fragment,{children:[s.jsx(de,{}),"변경"]}),h&&s.jsx(s.Fragment,{children:"완료"})]})]}),s.jsxs(Y,{spinning:k,children:[!h&&s.jsxs("div",{className:"text-lg font-medium text-slate-500 px-2 py-1",children:[a==="title"&&t.strfTitle,a==="state"&&pe(t.state),a==="tell"&&(t.areaCode?`${t.areaCode}-${t.tell}`:`${t.tell}`),a==="detail"&&t.detail,a==="amenity"&&s.jsx("ul",{className:"flex flex-wrap items-center gap-3 ",children:t.amenity.map((e,l)=>l<t.amenity.length-1?s.jsxs("li",{children:[O(e),","]},l):s.jsx("li",{children:O(e)},l))}),a==="duration"&&`${t.startAt}~${t.endAt}`,a==="checkTime"&&t.openCheck&&t.closeCheck&&`${A(t.openCheck,"HH:mm:ss").format("HH:mm")}~${A(t.closeCheck,"HH:mm:ss").format("HH:mm")}`,a==="restDate"&&t.restDate.map((e,l)=>l===t.restDate.length-1?s.jsx("span",{children:E(e)},l):s.jsxs("span",{children:[E(e),", "]},l)),a==="strfPic"&&s.jsx("ul",{className:"flex flex-wrap gap-2",children:t.strfPics.map((e,l)=>s.jsx("li",{className:"bg-slate-100 rounded-lg overflow-hidden w-full max-h-[200px] h-[53.33vw]",children:s.jsx("img",{src:`${ue}/${u}/${e.strfPic}`,alt:e.strfPic,className:"w-full h-full object-cover"})},l))}),a==="address"&&t.address]}),h&&a==="title"&&s.jsx(F,{size:"large",defaultValue:t.strfTitle,placeholder:"업체 이름을 입력해주세요(공백 입력시 이전 이름이 유지됩니다)",onChange:e=>{c(e.target.value)},status:(r==null?void 0:r.trim())===""?"error":void 0}),h&&a==="state"&&s.jsx(v,{defaultValue:t.state,options:le,size:"large",className:"w-1/3 ",onChange:e=>c(e)}),h&&a==="tell"&&s.jsx(F,{addonBefore:oe,size:"large",defaultValue:t.tell,placeholder:"전화번호를 입력해주세요.",onChange:e=>c(e.target.value),value:ne(r??"0"),maxLength:8,status:!D||!r?"error":void 0}),h&&a==="detail"&&s.jsx(me,{placeholder:"업체 소개를 작성해주세요",maxLength:300,onChange:e=>{c(e.target.value)},style:{resize:"none",height:"27.73vw",padding:"20px"},value:r,status:(r==null?void 0:r.trim())===""?"error":void 0}),h&&a==="amenity"&&s.jsx("div",{className:"flex flex-wrap gap-2",children:ge.map((e,l)=>s.jsxs("button",{type:"button",className:`flex text-base items-center gap-2
                          border rounded-2xl w-fit px-2 py-1
                          ${r.includes(e.amenity_id)?"border-primary text-primary":"border-slate-300 text-slate-500"}`,onClick:()=>U(e.amenity_id),children:[e.icon,e.key]},l))}),h&&a==="busiHour"&&s.jsx("div",{children:s.jsx(_.RangePicker,{defaultValue:[A(t.startAt),A(t.endAt)],format:"HH:mm"})}),h&&a==="checkTime"&&s.jsx("div",{children:s.jsx(_.RangePicker,{defaultValue:[A(t!=null&&t.openCheck&&t.openCheck!==""?t.openCheck:"00:00","HH:mm"),A(t!=null&&t.closeCheck&&t.closeCheck!==""?t.closeCheck:"00:00","HH:mm")],minuteStep:10,format:"HH:mm",onChange:e=>{e&&c([e[0]?e[0].format("HH:mm"):"",e[1]?e[1].format("HH:mm"):""])}})}),h&&a==="restDate"&&s.jsxs("div",{className:"flex gap-3",children:[s.jsx(v,{options:L.frequency,placeholder:"휴무 주기",defaultValue:"weekly",size:"large",onChange:e=>{e==="none"&&y({...t,restDate:[]}),Q(e)}}),s.jsx(v,{options:L.day,placeholder:"요일 선택",size:"large",mode:"multiple",allowClear:!0,className:"w-full",value:r,onChange:e=>{c(e)},disabled:S==="none"})]})]})]})},b=j.memo(Ae),Ne=()=>{const[$]=P(),a=$.get("category");return s.jsxs(s.Fragment,{children:[s.jsx(b,{title:"업체 이름",type:"title"}),s.jsx(b,{title:"업체 전화번호",type:"tell"}),s.jsx(b,{title:"업체 소개",type:"detail"}),a===N.STAY&&s.jsx(b,{title:s.jsxs("span",{className:"flex items-center gap-2",children:["업체 편의 정보"," ",s.jsx(be,{trigger:"hover",placement:"right",content:"* 검색 시 사용되는 정보입니다.",children:s.jsx("button",{type:"button",children:s.jsx(he,{className:"text-lg text-slate-300 cursor-help"})})})]}),type:"amenity"}),s.jsx(b,{title:"업체 주소",type:"address"}),s.jsx(b,{title:"업체 사진",type:"strfPic"})]})};A.extend(Ce);const Te=({})=>{const[$]=P(),a=$.get("category"),f=x=>{if(x===N.STAY)return"입실/퇴실 시간";if(x===N.RESTAURANT)return"영업 시간";if(x===N.TOUR||N.FEST)return"개장 시간"};return s.jsxs(s.Fragment,{children:[a===N.FEST&&s.jsx(b,{title:"축제 기간",type:"duration"}),s.jsx(b,{title:"업체 상태",type:"state"}),s.jsx(b,{title:f(a),type:"checkTime"}),s.jsx(b,{title:"휴무일",type:"restDate"})]})},De=({list:$,current:a,changeCateIndex:f})=>s.jsxs("div",{className:"flex flex-col gap-3 mb-1",children:[s.jsx("section",{children:s.jsx("ul",{className:"flex items-center w-full",children:$.map((x,d)=>s.jsxs("li",{className:`w-full flex items-center justify-center gap-2 text-lg font-semibold py-2 cursor-pointer
          ${a===d?"text-primary border-b-4 border-primary":"text-slate-400 border-b-2 border-slate-200"}
          transition-all duration-300`,onClick:()=>{f(d)},children:[x.icon,x.label]},d))})}),s.jsx("section",{children:$[a].children})]}),at=()=>{const $=V("accessToken"),[a]=P(),f=a.get("strfId"),x=a.get("category"),d=Number(a.get("tab")),[,w]=q(K),[u,I]=j.useState(d),[H,T]=j.useState(!1),t=async()=>{const k="/api/detail/member";T(!0);try{const r=(await g.get(`${k}?strf_id=${f}`,{headers:{Authorization:`Bearer ${$}`}})).data;if(r){const c=r.data.tell.split("-");w(S=>({...S,...r.data,areaCode:c[0],tell:`${c[1]}-${c[2]}`})),T(!1)}return r}catch(i){return T(!1),console.log("상품조회",i),null}},y=async()=>{const k="/api/detail/amenity";try{const r=(await g.get(`${k}?strf_id=${f}&category=숙소`,{headers:{Authorization:`Bearer ${$}`}})).data;return w(c=>({...c,amenity:r.data.map(S=>S.amenityId)})),r}catch{return null}},h=[{label:s.jsx("p",{children:"기본 정보"}),children:s.jsx(Ne,{})},{label:s.jsx("p",{children:"운영 정보"}),children:s.jsx(Te,{})}],z=k=>{I(k)};return j.useEffect(()=>{t(),x===N.STAY&&y()},[]),s.jsxs("div",{children:[s.jsx(ke,{}),s.jsx(Y,{spinning:H,children:s.jsx(De,{list:h,changeCateIndex:z,current:u})})]})};export{at as default};
